



<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Team Hub</title>
    <? function include(filename) { return HtmlService.createHtmlOutputFromFile(filename).getContent(); } ?>
    <style>


:root {
  /* choose one primary font family */
  --font-main: 'Inter', 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;

  /* color & text smoothing (optional) */
  --text-color: #e6edf3;
}

/* global baseline */
body, button, input, select, textarea {
  font-family: var(--font-main);
  color: var(--text-color);
  font-size: 14px;
  letter-spacing: 0.2px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* unify tab text */
.tab {
  font-family: var(--font-main);
  font-size: 14px;
  font-weight: 500;
  letter-spacing: 0.3px;
  text-transform: none;
  color: var(--text-color);
}

/* unify filter dropdowns and buttons */
.notes-filters select,
.notes-filters input,
button.apply,
button.clear {
  font-family: var(--font-main);
  font-size: 13px;
  color: var(--text-color);
}

















      :root {
        --bg:#0b0d10; --panel:#14181f; --muted:#79839a; --text:#e9edf6; --accent:#4aa8ff;
        --card:#1b2130; --chip:#232b3d; --border:#2a3448; --ok:#2ecc71; --warn:#ffb020; --bad:#ff5a5f;
        --chart-card-max:360px;
      }
html,body { margin:0; padding:0; background:var(--bg); color:var(--text); font:14px/1.45 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; }
.wrap { max-width:1200px; margin:0 auto; padding:24px; }
.wrap-narrow {
  display:none;
  width:100%;
  padding:16px;
  gap:16px;
  box-sizing:border-box;
}

.mobile-tabbar {
  display:none;
  position:sticky;
  bottom:0;
  left:0;
  right:0;
  grid-auto-flow:column;
  grid-auto-columns:1fr;
  gap:6px;
  padding:8px 12px;
  background:rgba(10,13,18,0.92);
  border-top:1px solid rgba(70,100,140,0.35);
  backdrop-filter:blur(12px);
  z-index:900;
}
.mobile-tabbar button {
  border:0;
  background:rgba(26,32,44,0.9);
  color:#cbd8f8;
  border-radius:12px;
  padding:8px 6px;
  font-size:12px;
  letter-spacing:0.3px;
  font-weight:600;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:2px;
}
.mobile-tabbar button span {
  font-size:11px;
  letter-spacing:0.2px;
}
.mobile-tabbar button.active {
  background:linear-gradient(135deg, rgba(74,168,255,0.9), rgba(134,77,255,0.9));
  color:#06142b;
  box-shadow:0 6px 16px rgba(74,168,255,0.35);
}

.panel-mobile-card {
  border:1px solid rgba(70,100,140,0.35);
  border-radius:16px;
  background:rgba(15,19,28,0.92);
  padding:16px;
  box-shadow:0 18px 40px rgba(0,0,0,0.45);
  display:flex;
  flex-direction:column;
  gap:12px;
}
.home-panel {
  display:flex;
  flex-direction:column;
  gap:18px;
}
.home-top {
  display:grid;
  gap:18px;
  grid-template-columns:repeat(auto-fit, minmax(280px, 1fr));
  align-items:stretch;
}
.home-panel .card { margin:0; }
.home-chart-card #teamLine {
  width:100%;
  min-height:260px;
}
.home-flags-card .ratingsWrap {
  max-height:360px;
}
.stats-opp-card {
  display:flex;
  flex-direction:column;
  gap:12px;
}
.stats-opp-card select {
  width:100%;
}
.league-scatter-wrap {
  position:relative;
  height:230px;
}
.league-scatter-wrap canvas {
  position:absolute;
  inset:0;
  width:100% !important;
  height:100% !important;
}
.opp-chart-row {
  display:flex;
  flex-wrap:wrap;
  gap:16px;
  justify-content:center;
  align-items:stretch;
}
.opp-chart-row > * {
  flex:1 1 300px;
  max-width:420px;
}
.opp-chart-wrap,
.shot-chart-wrap,
.four-chart-wrap {
  margin:6px 0;
  width:100%;
  min-width:260px;
  max-width:420px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  position:relative;
  overflow:hidden;
}
.opp-chart-wrap canvas,
.shot-chart-wrap canvas,
.four-chart-wrap canvas {
  width:min(100%, 360px) !important;
  height:auto !important;
  max-height:340px;
  margin:0 auto;
}
.profile-tag-row {
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  margin:8px 0 12px;
}
.profile-tag {
  display:inline-flex;
  align-items:center;
  padding:4px 8px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.18);
  font-size:11px;
  letter-spacing:0.2px;
  background:rgba(74,168,255,0.14);
  color:#d5e5ff;
}
.profile-tag.featured {
  background:rgba(255,176,32,0.22);
  border-color:rgba(255,176,32,0.35);
  color:#ffe5b5;
}
.opp-insights-grid {
  display:grid;
  gap:12px;
  grid-template-columns:repeat(auto-fit, minmax(220px, 1fr));
}
.opp-insight {
  background:rgba(255,255,255,0.02);
  border:1px solid var(--border);
  border-radius:10px;
  padding:10px;
  font-size:13px;
}
.opp-insight ul {
  margin:4px 0 0;
  padding-left:18px;
}
.opp-insight li {
  margin-bottom:6px;
}
.opp-insight li:last-child {
  margin-bottom:0;
}
.opp-profile-table {
  width:100%;
  border-collapse:collapse;
  font-size:12.5px;
}
.opp-profile-table th,
.opp-profile-table td {
  padding:4px 6px;
  border-bottom:1px solid rgba(255,255,255,0.07);
  text-align:right;
}
.opp-profile-table th:first-child,
.opp-profile-table td:first-child {
  text-align:left;
}
.opp-profile-table tr:last-child td {
  border-bottom:none;
}
.diff-chip {
  display:inline-block;
  margin-left:6px;
  padding:2px 6px;
  border-radius:999px;
  font-size:10.5px;
  font-weight:600;
  letter-spacing:0.1px;
}
.diff-chip.pos {
  background:rgba(46,204,113,0.18);
  color:#45d17b;
}
.diff-chip.neg {
  background:rgba(255,90,95,0.20);
  color:#ff6f76;
}
.diff-chip.neutral {
  background:rgba(255,255,255,0.08);
  color:#cbd6ee;
}
  font-size:13px;
}
.opp-profile-table th,
.opp-profile-table td {
  padding:6px 4px;
  border-bottom:1px solid var(--border);
  text-align:right;
}
.opp-profile-table th:first-child,
.opp-profile-table td:first-child {
  text-align:left;
}
.diff-chip {
  display:inline-block;
  margin-left:6px;
  padding:2px 6px;
  border-radius:999px;
  font-size:11px;
  font-weight:600;
  letter-spacing:0.1px;
}
.diff-chip.pos {
  background:rgba(46,204,113,0.18);
  color:#45d17b;
}
.diff-chip.neg {
  background:rgba(255,90,95,0.18);
  color:#ff6f76;
}
.diff-chip.neutral {
  background:rgba(255,255,255,0.08);
  color:#cbd6ee;
}
.summary-card-header {
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.summary-card-header h2 {
  margin:0;
  font-size:16px;
  letter-spacing:0.3px;
}
.home-session-summary {
  display:flex;
  flex-direction:column;
  gap:16px;
}
.home-session-meta {
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  justify-content:space-between;
  align-items:flex-start;
}
.home-session-title {
  font-size:18px;
  font-weight:600;
  letter-spacing:0.3px;
  color:var(--text,#e6edf3);
}
.home-session-sub {
  font-size:13px;
  color:var(--muted,#8a96b3);
}
.home-session-stats {
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));
  gap:12px;
}
.home-session-stat {
  padding:12px 14px;
  border-radius:14px;
  background:var(--chip,#232b3d);
  border:1px solid rgba(255,255,255,0.07);
  display:flex;
  flex-direction:column;
  gap:6px;
}
.home-session-stat .label {
  font-size:12px;
  text-transform:uppercase;
  letter-spacing:0.5px;
  color:var(--muted,#8a96b3);
}
.home-session-stat .value {
  font-size:20px;
  font-weight:600;
  color:var(--text,#e6edf3);
}
.home-session-stat .delta {
  font-size:12px;
}
.home-session-coach-table {
  border-radius:14px;
  border:1px solid rgba(255,255,255,0.07);
  background:rgba(15,20,30,0.65);
  padding:12px 14px;
  overflow:auto;
}
.home-session-coach-table table {
  width:100%;
  border-collapse:collapse;
}
.home-session-coach-table th,
.home-session-coach-table td {
  text-align:left;
  padding:8px 10px;
  border-bottom:1px solid rgba(255,255,255,0.06);
  font-size:13px;
  color:var(--text,#e6edf3);
}
.home-session-coach-table th {
  font-size:12px;
  text-transform:uppercase;
  letter-spacing:0.4px;
  color:var(--muted,#8a96b3);
}
.home-session-coach-table tr:last-child td { border-bottom:none; }
.home-session-notes {
  border-radius:14px;
  border:1px solid rgba(74,168,255,0.25);
  background:rgba(74,168,255,0.05);
  padding:12px 14px;
}
.home-session-notes h3 {
  margin:0 0 8px;
  font-size:14px;
  letter-spacing:0.4px;
}
.home-session-notes-list {
  list-style:none;
  padding:0;
  margin:0;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.home-session-notes-list li {
  border-radius:10px;
  border:1px solid rgba(74,168,255,0.4);
  background:rgba(15,25,36,0.75);
  padding:10px 12px;
}
.home-session-notes-list strong {
  display:block;
  font-size:13px;
  color:var(--text,#e6edf3);
}
.home-session-notes-list .note-meta {
  font-size:11px;
  color:var(--muted,#8a96b3);
  margin-top:4px;
}
.home-session-player-list {
  border-radius:14px;
  border:1px solid rgba(255,255,255,0.07);
  background:rgba(13,18,28,0.7);
  padding:12px 14px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.home-session-player-list h3 {
  margin:0;
  font-size:14px;
  letter-spacing:0.3px;
}
.home-session-player-list ul {
  list-style:none;
  margin:8px 0 0;
  padding:0;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.home-session-player-list li {
  border:1px solid rgba(74,168,255,0.25);
  border-radius:12px;
  background:rgba(15,24,36,0.75);
  padding:10px 12px;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.home-session-player-list .top-row {
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:8px;
}
.home-session-player-list .player-name {
  font-size:14px;
  font-weight:600;
  color:var(--text,#e6edf3);
}
.home-session-player-list .player-avg {
  font-size:18px;
  font-weight:600;
  color:var(--text,#e6edf3);
}
.home-session-player-list .player-coaches {
  font-size:11px;
  color:var(--muted,#8a96b3);
  text-transform:uppercase;
  letter-spacing:0.4px;
}
.home-session-player-list .player-note {
  font-size:12px;
  color:var(--text,#e6edf3);
  line-height:1.4;
}
.home-session-player-list .player-note .note-meta {
  font-size:11px;
  color:var(--muted,#8a96b3);
  margin-top:2px;
}
.home-session-player-list .player-note .note-text {
  margin-top:4px;
}
.home-session-empty {
  font-size:13px;
  color:var(--muted,#8a96b3);
}
.gamestats-controls {
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  align-items:center;
  margin-bottom:16px;
}
.gamestats-controls select,
.gamestats-controls button {
  min-height:32px;
  border-radius:8px;
  border:1px solid rgba(86,105,132,0.6);
  background:rgba(17,23,33,0.9);
  color:var(--text,#e6edf3);
  padding:6px 10px;
  font-size:13px;
}
.gamestats-controls button {
  background:var(--accent,#4aa8ff);
  border:none;
  color:#06142b;
  font-weight:600;
  cursor:pointer;
  transition:opacity 0.2s ease;
}
.gamestats-controls button:disabled {
  opacity:0.6;
  cursor:default;
}
.gamestats-summary {
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(220px, 1fr));
  gap:16px;
  margin-bottom:18px;
}
.gs-card {
  border:1px solid rgba(70,100,140,0.35);
  border-radius:14px;
  background:rgba(15,19,28,0.92);
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.gs-meta {
  font-size:13px;
  color:var(--muted,#79839a);
  display:flex;
  flex-direction:column;
  gap:4px;
}
.gs-meta strong {
  color:var(--text,#e6edf3);
  font-size:15px;
}
.gs-metric-list {
  list-style:none;
  padding:0;
  margin:0;
  display:flex;
  flex-direction:column;
  gap:6px;
  font-size:13px;
  color:var(--text,#e6edf3);
}
.gs-metric-list li {
  display:flex;
  justify-content:space-between;
  gap:8px;
}
.gs-metric-list li span {
  color:var(--muted,#79839a);
}
.table-wrap {
  overflow:auto;
  border:1px solid rgba(70,100,140,0.25);
  border-radius:12px;
  background:rgba(12,18,28,0.85);
}
.table-wrap table {
  width:100%;
  border-collapse:collapse;
  min-width:680px;
}
.table-wrap thead {
  background:rgba(26,32,44,0.8);
}
.table-wrap th,
.table-wrap td {
  padding:10px 12px;
  font-size:13px;
  text-align:left;
  border-bottom:1px solid rgba(70,100,140,0.25);
}
.table-wrap tbody tr:last-child td {
  border-bottom:none;
}
.table-wrap tbody tr:nth-child(even) {
  background:rgba(28,36,48,0.4);
}
.gamestats-charts {
  display:flex;
  flex-direction:column;
  gap:16px;
  width:100%;
}
.gamestats-section {
  width:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  text-align:center;
  gap:10px;
  padding:16px;
  border-radius:12px;
  background:rgba(20,24,31,0.92);
  border:1px solid rgba(70,100,140,0.35);
  position:relative;
  overflow:hidden;
}
.gamestats-section.chart-span {
  justify-content:center;
}
.gamestats-section canvas {
  display:block;
  margin:0 auto;
}
.gamestats-section.chart-duo canvas {
  width:min(100%, 340px) !important;
  max-width:340px;
}
.gamestats-canvas-wrap {
  position:relative;
  width:100%;
  height:230px;
  overflow:hidden;
}
.gamestats-canvas-wrap canvas {
  position:absolute;
  inset:0;
  width:100% !important;
  height:100% !important;
}
.gs-chart-square {
  max-width:var(--chart-card-max);
  aspect-ratio:1 / 1;
  width:100%;
}

@media (min-width: 640px) {
  .gamestats-charts {
    display:grid;
    grid-template-columns:repeat(2, minmax(0, 1fr));
    gap:24px;
  }
  .gamestats-section.chart-span {
    grid-column:1 / -1;
    align-items:stretch;
  }
  .gamestats-canvas-wrap {
    height:230px;
  }
  .gamestats-section.chart-span .gs-chart-square {
    max-width:100%;
  }
  .gamestats-section.chart-duo canvas {
    width:min(100%, 420px) !important;
    max-width:420px;
  }
.gamestats-section.chart-duo .gs-chart-square {
  max-width:420px;
}
}
.shotmap-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
}
.shotmap-meta {
  display:flex;
  align-items:center;
  gap:10px;
  color:var(--muted,#79839a);
  font-size:13px;
}
#panel-shotmap {
  gap:18px;
}
#panel-shotmap.panel.active {
  display:flex;
  flex-direction:column;
}
#panel-predictions {
  gap:18px;
}
#panel-predictions.panel.active {
  display:flex;
  flex-direction:column;
}
.shotmap-layout {
  display:grid;
  grid-template-columns:280px minmax(420px, 1fr) 280px;
  gap:18px;
}
@media (max-width: 1200px) {
  .shotmap-layout {
    grid-template-columns:260px minmax(0, 1fr);
  }
  .shotmap-stats {
    grid-column:1 / -1;
    order:3;
  }
}
@media (max-width: 880px) {
  .shotmap-layout {
    grid-template-columns:1fr;
  }
  .shotmap-filter,
  .shotmap-center,
  .shotmap-stats {
    grid-column:1 / -1;
  }
}
.shotmap-filter,
.shotmap-center,
.shotmap-stats {
  background:var(--card,#1b2130);
  border:1px solid var(--border,#2a3448);
  border-radius:14px;
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:14px;
}
.shotmap-filter h3,
.shotmap-stats h3 {
  font-size:15px;
  margin:0;
  font-weight:600;
  color:var(--text,#e9edf6);
}
.shotmap-filter .shotmap-group {
  display:grid;
  gap:10px;
}
.shotmap-filter label {
  display:flex;
  flex-direction:column;
  gap:6px;
  font-size:13px;
  color:var(--muted,#79839a);
}
.shotmap-filter select,
.shotmap-filter input[type="range"] {
  width:100%;
}
.shotmap-filter .shotmap-inline {
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.shotmap-filter .shotmap-inline span {
  font-size:12px;
  color:var(--muted,#79839a);
}
.shotmap-filter button {
  width:100%;
}
.shot-stage {
  position:relative;
  width:100%;
  max-width:560px;
  margin:0 auto;
  border-radius:16px;
  background:rgba(10,13,18,0.85);
  border:1px solid rgba(80,100,140,0.35);
  overflow:hidden;
  aspect-ratio:500 / 470;
  min-height:240px;
  box-shadow:0 20px 40px rgba(0,0,0,0.28);
}
.shot-stage-layer {
  position:absolute;
  inset:0;
}
#shot-canvas {
  width:100%;
  height:100%;
}
.shot-badges {
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.shot-badges .badge {
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  background:rgba(20,24,34,0.8);
  border:1px solid rgba(90,120,160,0.35);
  border-radius:999px;
  font-size:12px;
  color:#dce6ff;
}
.shot-legend {
  display:flex;
  flex-wrap:wrap;
  gap:16px;
  align-items:center;
  font-size:12px;
  color:var(--muted,#79839a);
}
.shot-legend .dot,
.shot-legend .ring,
.shot-legend .swatch {
  display:inline-block;
  vertical-align:middle;
}
.shot-legend .dot {
  width:12px;
  height:12px;
  border-radius:50%;
}
.shot-legend .ring {
  width:12px;
  height:12px;
  border-radius:50%;
  border:2px solid #ccd6ff;
  box-sizing:border-box;
}
.shot-legend .swatch {
  width:180px;
  height:12px;
  border-radius:999px;
  border:1px solid rgba(160,180,220,0.4);
}
.shotmap-stats .card-section {
  background:rgba(14,18,26,0.75);
  border:1px solid rgba(80,110,150,0.3);
  border-radius:12px;
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.shotmap-stats .card-section h4 {
  margin:0;
  font-size:13px;
  font-weight:600;
  color:#dce6ff;
}
#shot-aggKvs {
  display:grid;
  grid-template-columns:1fr auto;
  gap:6px 12px;
  font-size:12px;
}
#shot-aggKvs div:nth-child(2n) {
  text-align:right;
  font-variant-numeric:tabular-nums;
  color:#f2f6ff;
}
.shot-dist-bars {
  display:grid;
  gap:10px;
}
.shot-dist-bar {
  display:grid;
  grid-template-columns:120px 1fr 50px;
  gap:10px;
  align-items:center;
  font-size:12px;
}
.shot-dist-track {
  height:10px;
  border-radius:999px;
  background:rgba(30,38,60,0.8);
  border:1px solid rgba(80,110,150,0.4);
  overflow:hidden;
}
.shot-dist-fill {
  height:100%;
  background:linear-gradient(90deg,#4aa8ff,#8ad5ff);
}
.shot-tip {
  position:fixed;
  z-index:9999;
  pointer-events:none;
  background:rgba(8,12,20,0.92);
  color:#eef6ff;
  font-size:12px;
  line-height:1.3;
  padding:6px 9px;
  border-radius:8px;
  box-shadow:0 12px 30px rgba(0,0,0,0.45);
  transform:translate(-50%,-120%);
  opacity:0;
  transition:opacity .12s ease;
  white-space:nowrap;
}
.home-session-list {
  list-style:none;
  padding:0;
  margin:8px 0 0;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.home-session-list li {
  border-bottom:1px solid rgba(255,255,255,0.06);
  padding-bottom:6px;
}
.home-session-list li:last-child { border-bottom:none; }
.upcoming-list {
  display:flex;
  flex-direction:column;
  gap:10px;
}
.upcoming-item {
  border:1px solid rgba(74,168,255,0.35);
  background:rgba(74,168,255,0.1);
  border-radius:12px;
  padding:10px;
}

#mobileNavOverlay {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.45);
  z-index:90;
}
body.mobile-nav-open #mobileNavOverlay { display:block; }
@media (min-width: 961px){
  #mobileNavOverlay { display:none !important; }
}

@media (max-width: 960px) {
  body { padding-bottom:72px; }
  #sideNav {
    width:240px;
    transform:translateX(-110%);
    pointer-events:none;
    box-shadow:0 18px 40px rgba(0,0,0,0.45);
    transition:transform .25s ease;
    opacity:0;
  }
  body.mobile-nav-open #sideNav {
    transform:translateX(0);
    pointer-events:auto;
    opacity:1;
  }
  body.mobile-nav-open { overflow:hidden; }
  body.sidebar-enabled .panel,
  body.sidebar-enabled .tabs {
    margin-left:0 !important;
  }
  .panel {
    border-radius:18px;
    padding:16px;
    margin:16px 12px;
    box-shadow:0 16px 32px rgba(0,0,0,0.35);
  }
  .panel:first-of-type { margin-top:18px; }
  .card {
    border-radius:16px;
    padding:14px;
  }
  .ratingsWrap,
  .table-wrap,
  #clipModalFooter {
    overflow:auto;
    -webkit-overflow-scrolling:touch;
  }
  table { min-width:600px; }
  #rtTable { min-width:100%; }
  #teamBox {
    grid-template-columns:1fr !important;
  }
  .grid.g2,
  .grid.g3 {
    grid-template-columns:1fr !important;
  }
  .mobile-tabbar {
    display:grid;
  }
}

@media (max-width: 640px) {
  .panel {
    padding:14px;
    margin:14px 10px;
  }
  .card { padding:12px; }
  h1 { font-size:20px; }
  h2 { font-size:16px; }
  .grid { gap:12px; }
  .chat-thread { height:46vh; }
}

@media (max-width: 500px) {
  .mobile-tabbar button { padding:10px 6px; font-size:16px; }
  .mobile-tabbar button span { display:none; }
}
.wrap-fluid { width:100%; }

/* Tabs */
.tabs { display:flex; gap:8px; margin-bottom:16px; border-bottom:1px solid var(--border); }
.tab { padding:10px 14px; cursor:pointer; border:1px solid var(--border); border-bottom:none; background:var(--panel); color:var(--muted); border-top-left-radius:10px; border-top-right-radius:10px; transition:background .2s ease; }
.tab.active { background:var(--card); color:var(--text); font-weight:600; }
.panel { display:none; background:var(--card); border:1px solid var(--border); border-radius:12px; padding:18px; }
.panel.active { display:block; }

      /* Layout */
      .grid { display:grid; gap:16px; }
      .g2 { grid-template-columns: minmax(0, 320px) minmax(0, 1fr); }
      .grid > * { min-width: 0; }
      .card { background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:14px; }

      h1 { font-size:20px; margin:0 0 6px; }
      h2 { font-size:16px; margin:16px 0 8px; }
      .muted { color:var(--muted); }
      .tag { display:inline-block; padding:4px 8px; background:var(--chip); border:1px solid var(--border); border-radius:999px; margin:2px 4px 2px 0; font-size:12px; color:#cbd6ee; }
      .sectionTitle { font-weight:700; margin:16px 0 6px; }

      /* Player sidebar */
      .avatar { width:160px; height:160px; border-radius:12px; object-fit:cover; display:none; box-shadow:0 2px 10px rgba(0,0,0,.35); border:1px solid var(--border); }
      .select { width:100%; padding:10px; border-radius:10px; background:#0f131a; color:var(--text); border:1px solid var(--border); }
      .kv { display:grid; grid-template-columns: 120px 1fr; gap:8px 12px; margin-top:10px; }
      .kv div:nth-child(odd){ color:#b8c4dd; }
      ul { margin:6px 0 0 18px; padding:0; }
      li { margin:4px 0; }

      #flagsTable td.num { font-size: 15px; }
      .card { max-width: 100%; overflow: hidden; }
#panel-players .card, #panel-players ul, #panel-players li { word-break: break-word; overflow-wrap: anywhere; }
.player-shot-wrap {
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:10px;
  border-radius:12px;
  background:rgba(12,18,28,0.85);
  border:1px solid rgba(74,168,255,0.2);
  margin-top:10px;
}
#pShotCanvas {
  width:100%;
  height:auto;
  max-width:360px;
  align-self:center;
  border-radius:8px;
  background:#0c121c;
  box-shadow:0 10px 26px rgba(0,0,0,0.25);
}
.trait-modal {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.78);
  z-index:36000;
  align-items:center;
  justify-content:center;
  padding:24px;
}
.trait-modal.active {
  display:flex;
}
#traitModalCard {
  width:90%;
  max-width:1100px;
  background:#14181f;
  border:1px solid #2a3448;
  border-radius:14px;
  box-shadow:0 28px 60px rgba(0,0,0,0.55);
  display:flex;
  flex-direction:column;
  max-height:90vh;
}
#traitModalHeader {
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:18px 20px;
  border-bottom:1px solid rgba(74,168,255,0.18);
}
#traitModalHeader h2 {
  margin:0;
  font-size:20px;
  font-weight:600;
  letter-spacing:0.3px;
}
#traitModalBody {
  padding:18px 20px;
  overflow:auto;
  display:flex;
  flex-direction:column;
  gap:14px;
}
#traitModalClose {
  border:0;
  background:none;
  color:#f2f6ff;
  font-size:24px;
  cursor:pointer;
  line-height:1;
}

      .embedWrap{
        position:relative;
        width:100%;
        aspect-ratio:16/9;
        background:#0f131a;
        border:1px solid var(--border);
        border-radius:10px;
        overflow:hidden;
      }
      .embedWrap iframe{
        position:absolute;
        inset:0;
        width:100%;
        height:100%;
        border:0;
      }

      #flagsTable th { text-align: center; }

      /* Clip list */
      .clip { border-bottom:1px dashed var(--border); padding:8px 0; }
      .clip:last-child { border-bottom:none; }
      .clip a { color:var(--accent); text-decoration:none; }
      .clip a:hover { text-decoration:underline; }
      .clipLine { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

      /* Filters row */
      .filters { display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-bottom:12px; }
      .filters select, .filters input { padding:8px 10px; border-radius:10px; background:#0f131a; color:var(--text); border:1px solid var(--border); }
      .btn { padding:9px 12px; border-radius:10px; background:var(--accent); color:#051423; border:0; cursor:pointer; font-weight:700; }
      .btn:disabled { opacity:.5; cursor:not-allowed; }

      /* Small progress bars (monospace) */
      .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }

      /* Empty states */
      .empty { color:#9aa6bf; background:#10141c; border:1px dashed var(--border); border-radius:10px; padding:16px; }

      /* Ratings table */
      table { width:100%; border-collapse: collapse; }
      th, td { padding:8px; border-bottom:1px solid var(--border); text-align:left; }
      th { position:sticky; top:0; background:var(--panel); z-index:1; }
      .num { text-align:center; font-variant-numeric: tabular-nums; }
      .stickyLeft { position:sticky; left:0; background:var(--panel); z-index:2; }
      .ratingsWrap {
  max-height: 70vh;            /* add this for vertical freeze */
  overflow: auto;
  border: 1px solid var(--border);
  border-radius: 12px;
}

      .hero { display:flex; flex-direction:column; align-items:center; justify-content:center; min-height: 50vh; gap: 16px; }
      .hero-logo { width: 160px; height:160px; object-fit:cover; border-radius:16px; border:1px solid var(--border); box-shadow:0 4px 20px rgba(0,0,0,.35); }
      .hero-title { margin:0; font-size:28px; letter-spacing:.5px; }

      .btn-danger {
        padding: 9px 12px;
        border-radius: 10px;
        background: #ff5a5f;
        color: white;
        border: 0;
        cursor: pointer;
        font-weight: 700;
      }
      .btn-danger:disabled { opacity: .5; cursor: not-allowed; }

      #createSummaryModal .grid label { display: flex; flex-direction: column; gap: 6px; width: 100%; }
      #createSummaryModal .grid input, #createSummaryModal .grid select, #createSummaryModal .grid textarea {
        max-width: 100%; box-sizing: border-box;
      }
      #createSummaryModal select { height: 38px; line-height: 1.3; font-size: 14px; }
      #createSummaryModal #sumDescription { grid-column: 1 / span 2; }



  .stat-bullet { display:flex; align-items:center; gap:10px; margin:6px 0; }
  .stat-label  { width:90px; color:var(--muted,#9aa4ad); }
  .stat-track  { position:relative; height:10px; width:260px; border-radius:999px; overflow:hidden; }
  .stat-dot    { position:absolute; top:50%; width:12px; height:12px; border-radius:50%;
                 transform:translate(-50%,-50%); border:1px solid rgba(0,0,0,.25); background:#fff; }
  .stat-tick   { position:absolute; top:50%; width:2px; height:14px; transform:translate(-50%,-50%);
                 background:rgba(255,255,255,.85); border-radius:2px; }
  .stat-meta   { display:flex; gap:10px; margin-left:auto; min-width:160px; justify-content:flex-end; }
  .chip        { padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid var(--border,#283241); }


/* Colored result text */
.result-win  { color: var(--ok, #2ecc71); font-weight: 600; }
.result-loss { color: var(--bad, #ff5a5f); font-weight: 600; }
.result-upcoming { color: var(--muted, #79839a); font-style: italic; }

/* Schedule pills */
.sched-pill{
  display:inline-block;
  vertical-align:top;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:10px;
  padding:8px 10px;
  margin-right:8px;
  min-width: 210px;
  max-width: 260px;
  white-space:normal;
  cursor:pointer;
  transition:transform .08s ease, box-shadow .12s ease;
}
.sched-pill:hover{ transform:translateY(-1px); box-shadow:0 2px 10px rgba(0,0,0,.25); }
.sched-head{ display:flex; align-items:center; justify-content:space-between; gap:8px; font-size:12px; color:var(--muted); }
.sched-title{ font-weight:700; margin-top:4px; }
.sched-venue{ font-size:11px; color:var(--muted); }
.sched-badges{ display:flex; gap:6px; margin-top:6px; align-items:center; }
.sched-chip{ font-size:11px; padding:2px 6px; border:1px solid var(--border); border-radius:999px; }
.sched-pppbar{ position:relative; height:4px; border-radius:999px; background:#0f131a; margin-top:8px; overflow:hidden; }
.sched-pppbar > div{ position:absolute; top:0; bottom:0; }
.sched-pill.win { border-color: rgba(46,204,113,.45); }
.sched-pill.loss{ border-color: rgba(255,90,95,.45); }
.sched-pill.next{ outline:2px solid rgba(74,168,255,.45); }

.sched-chip.home { border-color:rgba(74,168,255,.4); }
.sched-chip.away { border-color:rgba(255,176,32,.4); }
.sched-chip.heba { border-color:#4aa8ff44; }
.sched-chip.fiba { border-color:#10b98155; }

/* Detail drawer */
#schedDetail .grid { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
@media (max-width:640px){ #schedDetail .grid{ grid-template-columns:1fr; } }








/* Sidebar presence list */
.sidePresence{
  margin:8px;
  margin-top:12px;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid rgba(70,82,104,0.55);
  background:rgba(12,16,24,0.6);
  display:flex;
  flex-direction:column;
  gap:8px;
}
.sidePresenceHeader{
  display:flex;
  align-items:center;
  justify-content:space-between;
  font-size:12px;
  color:#9aa5be;
}
.sidePresenceList{
  max-height:160px;
  overflow:auto;
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.presence-badge{
  display:inline-block;
  padding:4px 9px;
  border-radius:999px;
  font-weight:600;
  background:#ff5a5f;
  color:white;
  font-size:12px;
}
.presence-empty{ color:#9aa6bf; font-size:12px; }
.presence-btn{
  background:transparent;
  border:0;
  color:#9aa6bf;
  cursor:pointer;
  font-weight:700;
  font-size:12px;
}


/* Coach notification toast – bottom-right, compact */
#coachNotify {
  position: fixed;
  bottom: 16px;
  right: 16px;

  /* IMPORTANT: prevent stretching */
  top: auto !important;
  left: auto !important;
  width: auto !important;
  max-width: 360px;

  z-index: 10020;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,.35);
  padding: 10px 12px;
  display: none;           /* set to block when showing */
}


/* Insights container → responsive grid */
.pl-insights {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); /* 2–4 per row depending on width */
  gap: 8px;
  margin-top: 6px;
  align-items: stretch;
}

/* Insight cards */
.insight {
  background: #fff;
  border: 1px solid #e5e7eb;
  border-left: 4px solid #60a5fa; /* default = info */
  border-radius: 10px;
  padding: 8px 10px;
  box-shadow: 0 1px 2px rgba(0,0,0,.05);
  box-sizing: border-box;
}

.insight-title {
  font-weight: 600;
  margin-bottom: 4px;
  color: #111827;
  font-size: 13px;
}

.insight-body {
  font-size: 13px;
  line-height: 1.35;
  color: #374151;
}

/* Kinds (match your JS: success|info|warn|error) */
.insight.success { border-left-color: #10b981; } /* green */
.insight.info    { border-left-color: #3b82f6; } /* blue */
.insight.warn    { border-left-color: #f59e0b; } /* amber */
.insight.error   { border-left-color: #ef4444; } /* red */

/* Optional: compact on very small screens */
@media (max-width: 420px) {
  .pl-insights { grid-template-columns: 1fr; }
}


/* ===== Mobile tweaks ===== */
@media (max-width: 820px) {
  .wrap { padding: 16px; }

  /* Tabs: make them scrollable chips across the top */
  .tabs {
    gap: 6px;
    overflow-x: auto;
    white-space: nowrap;
    padding: 0 8px 8px;
    scrollbar-width: none;
  }
  .tabs::-webkit-scrollbar { display: none; }
  .tab {
    padding: 8px 12px;
    font-size: 13px;
    border-radius: 999px;
  }

  /* Panels and cards tighter on mobile */
  .panel { padding: 12px; }
  .card  { padding: 12px; }

  /* Two-column → one column */
  .g2 { grid-template-columns: 1fr; }

  /* Player photo smaller */
  .avatar { width: 120px; height: 120px; }

  /* Ratings tables: allow horizontal scroll */
  .ratingsWrap { overflow: auto; }
  table { min-width: 680px; } /* keep columns usable; scroll on small */

  /* Filters: stack vertically */
  .filters {
    gap: 6px;
    flex-direction: column;
    align-items: stretch;
  }
  .filters select, .filters input, .filters .btn, .filters .btn-danger {
    width: 100%;
  }

  /* Embed/video: full width & sane height */
  .embedWrap { aspect-ratio: 16/9; }

  /* Coach notify toast: fit width, respect safe areas */
  #coachNotify {
    right: max(12px, env(safe-area-inset-right));
    left: max(12px, env(safe-area-inset-left));
    bottom: max(12px, env(safe-area-inset-bottom));
    max-width: none;
    width: auto;
  }

  /* Login overlay box: fill nicely on phones */
  #loginOverlay > div { max-width: 360px; width: 92%; }
}

/* Bigger tap targets (nice on touch) */
button, .btn, .btn-danger, .presence-btn {
  min-height: 38px;
}

/* Prevent accidental zoom on iOS when tapping inputs */
input, select, textarea { font-size: 16px; }



body.player-only .tabs { display: none; }
body.player-only #panel-opponents { display: block; }
body.player-only #presenceWidget,
body.player-only #coachNotify { display: none !important; }


/* Player mode: make Opponents layout tight and centered */
body.player-only .tabs { display: none; }
body.player-only #panel-opponents { display: block; }
body.player-only .wrap { max-width: 900px; }


/* Freeze header row */
#ratingsTable thead th {
  position: sticky;
  top: 0;
  background: var(--panel);
  z-index: 5;          /* above body cells */
}

/* Freeze first column (you already add .stickyLeft in JS) */
#ratingsTable td.stickyLeft {
  position: sticky;
  left: 0;
  background: var(--panel);
  z-index: 4;          /* below header-left cell, above normal cells */
}

/* Top-left corner cell (header + first column) */
#ratingsTable th.stickyLeft {
  left: 0;
  z-index: 6;          /* highest so it sits on top */
}



/* --- Stats table visual cleanup --- */
#statsPlayersTable {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed; /* key for equal cell width */
  font-size: 13px;
}

#statsPlayersTable th,
#statsPlayersTable td {
  padding: 6px 4px;
  text-align: center; /* center all text */
  border-bottom: 1px solid var(--border, #ddd);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Left-align the player name only */
#statsPlayersTable th:first-child,
#statsPlayersTable td:first-child {
  text-align: left;
}

/* Slight background banding */
#statsPlayersTable tr:nth-child(even) {
  background: rgba(0, 0, 0, 0.02);
}

/* Smooth hover highlight */
#statsPlayersTable tr:hover {
  background: rgba(0, 128, 255, 0.08);
  transition: background 0.15s ease;
}

/* Make numeric columns all equal width */
#statsPlayersTable th:not(:first-child),
#statsPlayersTable td:not(:first-child) {
  width: 5.3%; /* tweak this to balance columns on your layout */
}






#alignTable {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}

#alignTable th, #alignTable td {
  padding: 8px 10px;
  border-bottom: 1px solid var(--border);
  font-size: 13px;
  vertical-align: middle;
}

#alignTable th {
  color: var(--text-muted);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

#alignTable th.left,
#alignTable td.trait {
  text-align: left;
  font-weight: 500;
  color: var(--text);
}

#alignTable th.right,
#alignTable td.num {
  text-align: right;
  font-variant-numeric: tabular-nums;
  color: var(--text);
}

#alignTable td.diff {
  font-weight: 600;
}

#alignTable tr:last-child td {
  border-bottom: none;
}


/* Tiny button style (home header) */
.btn.btn-small { height:28px; padding:0 10px; font-size:12px; border-radius:8px; }

/* Modal shell */
.modal {
  position: fixed; inset: 0;
  background: rgba(0,0,0,.55);
  display: none; align-items: center; justify-content: center;
  z-index: 1000;
}
.modal-card {
  width: min(1000px, 96vw);
  max-height: 88vh;
  overflow: hidden;
  background: var(--bg, #14181f);
  border: 1px solid var(--border, #2a3441);
  border-radius: 14px;
  box-shadow: 0 20px 60px rgba(0,0,0,.6);
  display: flex; flex-direction: column;
}
.modal-card > header {
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 12px; border-bottom:1px solid var(--border);
  font-weight:600;
}
.modal-card > header .icon {
  background: transparent; border: 1px solid var(--border);
  color: var(--text,#e6e6e6); border-radius:10px; padding:4px 8px; cursor:pointer;
}
.modal-body { padding:10px; overflow:auto; }

/* Form strip */
.rate-form {
  display:flex; gap:8px; align-items:center; margin-bottom:8px; flex-wrap: wrap;
}
.rate-form label { display:flex; flex-direction:column; gap:6px; min-width:180px; }
.rate-form label > span { font-size:12px; color: var(--muted,#9aa7b4); }
.rate-form select, .rate-form input[type="date"] {
  height:34px; border-radius:10px; border:1px solid var(--border);
  background: var(--bg2,#161b22); color: var(--text,#e6e6e6); padding:0 10px; font-size:13px;
}
.rate-form .apply { margin-left:auto; }
.rate-form .grow { flex:1 1 auto; }

/* Quick fill */
.rate-quickfill { display:flex; gap:8px; align-items:center; margin:6px 0 10px; }
.rate-quickfill select, .rate-quickfill .btn {
  height:32px; border-radius:10px; border:1px solid var(--border);
  background: var(--bg2,#161b22); color: var(--text,#e6e6e6); padding:0 10px; font-size:13px;
}

/* Ratings table */
.rate-table {
  border:1px solid var(--border);
  border-radius:14px;
  background:linear-gradient(145deg, rgba(27,33,44,.96), rgba(17,21,28,.94));
  box-shadow:0 12px 40px rgba(0,0,0,.45);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}
.rate-table-scroll {
  max-height:55vh;
  overflow:auto;
  position:relative;
}
.rate-table-scroll::-webkit-scrollbar { width:11px; }
.rate-table-scroll::-webkit-scrollbar-track { background:rgba(12,16,22,.6); }
.rate-table-scroll::-webkit-scrollbar-thumb {
  background:rgba(70,104,160,.55);
  border-radius:999px;
}
.rate-table-scroll::-webkit-scrollbar-thumb:hover { background:rgba(90,130,190,.65); }
.rate-table-hint {
  padding:10px 14px;
  border-bottom:1px solid rgba(255,255,255,0.07);
  font-size:12px;
  color:var(--muted,#97a4c0);
  display:flex;
  gap:10px;
  align-items:center;
}
.rate-table-hint svg {
  width:16px; height:16px; flex-shrink:0; fill:var(--muted,#97a4c0);
}
#rtTable {
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  table-layout:fixed;
}
#rtTable thead th,
#rtTable tbody td,
#rtTable tbody th {
  padding:12px 14px;
  border-bottom:1px solid rgba(255,255,255,0.06);
  vertical-align:top;
}
#rtTable thead th {
  position:sticky;
  top:0;
  background:rgba(20,25,34,.97);
  backdrop-filter:blur(6px);
  z-index:4;
  text-transform:uppercase;
  letter-spacing:0.4px;
  font-size:12px;
  font-weight:600;
  color:#cdd8f8;
}
#rtTable thead th[data-tip] {
  cursor:help;
}
#rtTable thead th::after {
  content:'';
  position:absolute;
  left:0;
  right:0;
  bottom:0;
  height:1px;
  background:rgba(0,0,0,0.35);
}
#rtTable thead th.player-col {
  left:0;
  z-index:6;
  min-width:200px;
  box-shadow:inset -1px 0 0 rgba(255,255,255,0.06);
}
#rtTable tbody th.rt-player {
  position:sticky;
  left:0;
  z-index:5;
  background:rgba(20,25,34,.95);
  font-weight:600;
  color:var(--text);
  text-align:left;
  min-width:190px;
  box-shadow:inset -1px 0 0 rgba(255,255,255,0.04);
  font-size:13px;
}
#rtTable tbody tr:nth-child(even) { background:rgba(255,255,255,0.025); }
#rtTable tbody tr:hover { background:rgba(74,168,255,0.08); }
#rtTable tbody tr:last-child td,
#rtTable tbody tr:last-child th { border-bottom:none; }
#rtTable tbody tr.rt-empty td {
  padding:32px 0;
  text-align:center;
  font-size:13px;
  color:var(--muted,#97a4c0);
}
.rt-player-name {
  display:flex;
  align-items:center;
  gap:6px;
  line-height:1.4;
}
.rt-score {
  text-align:center;
  width:82px;
}
.rt-note-cell {
  min-width:360px;
  width:100%;
}
#rtTable select {
  height:34px;
  min-width:60px;
  border-radius:8px;
  border:1px solid rgba(86,105,132,.6);
  background:rgba(17,23,33,.9);
  color:var(--text,#e6e6e6);
  padding:0 10px;
  font-size:13px;
  appearance:none;
  transition:border-color .2s ease, box-shadow .2s ease;
  background-image: linear-gradient(45deg, transparent 50%, #4aa8ff 50%), linear-gradient(135deg, #4aa8ff 50%, transparent 50%);
  background-position: calc(100% - 16px) calc(50% - 4px), calc(100% - 10px) calc(50% - 4px);
  background-size:6px 6px, 6px 6px;
  background-repeat:no-repeat;
}
#rtTable select:focus {
  outline:none;
  border-color:var(--accent,#4aa8ff);
  box-shadow:0 0 0 2px rgba(74,168,255,0.25);
  background-color:rgba(19,26,36,.95);
}
#rtTable textarea {
  width:100%;
  min-height:72px;
  resize:vertical;
  border-radius:10px;
  border:1px solid rgba(86,105,132,.55);
  background:rgba(18,24,33,.92);
  color:var(--text,#e6e6e6);
  padding:8px 10px;
  font-size:13px;
  transition:border-color .2s ease, box-shadow .2s ease;
}
#rtTable textarea::placeholder {
  color:rgba(197,210,234,0.55);
}
#rtTable textarea:focus {
  outline:none;
  border-color:var(--accent,#4aa8ff);
  box-shadow:0 0 0 2px rgba(74,168,255,0.22);
  background:rgba(20,27,38,.96);
}
.trait-tooltip {
  position:fixed;
  max-width:260px;
  background:rgba(23,32,48,0.95);
  color:#eef3ff;
  padding:10px 12px;
  border-radius:10px;
  font-size:12px;
  line-height:1.5;
  box-shadow:0 14px 36px rgba(0,0,0,0.5);
  pointer-events:none;
  opacity:0;
  transform:translate(-50%, -4px) scale(0.96);
  transition:opacity 120ms ease, transform 120ms ease;
  z-index:9999;
}
.trait-tooltip.is-visible {
  opacity:1;
  transform:translate(-50%, -12px) scale(1);
}
.rate-message {
  margin-top:10px;
  font-size:13px;
  min-height:18px;
}

@media (max-width: 720px) {
  .rate-table-scroll { max-height:60vh; }
  #rtTable thead th,
  #rtTable tbody td,
  #rtTable tbody th { padding:10px 12px; }
  #rtTable select { min-width:52px; font-size:12px; }
  #rtTable textarea { font-size:12px; }
}

/* Coach chat */
.chat-shell {
  max-width: 860px;
  margin: 0 auto;
  background: linear-gradient(140deg, rgba(20,24,32,0.92), rgba(12,16,24,0.92));
  border-radius: 18px;
  border: 1px solid rgba(78,106,150,0.35);
  box-shadow: 0 18px 45px rgba(0,0,0,0.55);
  padding: 18px 20px 20px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}
.chat-header {
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:14px;
}
.chat-header h2 {
  margin:0;
  font-size:20px;
  letter-spacing:0.6px;
}
.chat-header p {
  margin:4px 0 0;
  color:var(--muted,#99a7c7);
  font-size:13px;
}
.chat-refresh {
  border:1px solid rgba(74,168,255,0.5);
  background:rgba(74,168,255,0.12);
  color:#a7cfff;
  border-radius:10px;
  padding:6px 12px;
  font-weight:600;
  cursor:pointer;
  transition:background .2s ease, transform .1s ease;
}
.chat-refresh:hover {
  background:rgba(74,168,255,0.2);
  transform:translateY(-1px);
}
.chat-controls {
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  align-items:center;
}
.chat-control-group {
  display:flex;
  flex-direction:column;
  gap:4px;
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:0.4px;
  color:var(--muted,#97a4c0);
}
.chat-label {
  font-size:11px;
  letter-spacing:0.4px;
}
.chat-target-select {
  min-width:220px;
  height:38px;
  border-radius:10px;
  border:1px solid rgba(86,105,132,0.6);
  background:rgba(15,19,28,0.95);
  color:var(--text,#e6e6e6);
  padding:0 12px;
  font-size:13px;
  appearance:auto;
  -webkit-appearance:menulist;
  transition:border-color .2s ease, box-shadow .2s ease;
  cursor:pointer;
}
.chat-target-select:focus {
  outline:none;
  border-color:var(--accent,#4aa8ff);
  box-shadow:0 0 0 2px rgba(74,168,255,0.25);
  background:rgba(19,24,34,0.98);
}
.chat-thread {
  height:48vh;
  overflow:auto;
  border-radius:14px;
  padding:18px 18px 14px;
  background:rgba(9,12,20,0.78);
  border:1px solid rgba(60,84,120,0.35);
  display:flex;
  flex-direction:column;
  gap:14px;
  scroll-behavior:smooth;
}
.chat-thread::-webkit-scrollbar { width:12px; }
.chat-thread::-webkit-scrollbar-track { background:rgba(8,11,18,0.85); }
.chat-thread::-webkit-scrollbar-thumb {
  background:rgba(94,128,190,0.55);
  border-radius:999px;
}
.chat-thread::-webkit-scrollbar-thumb:hover {
  background:rgba(118,152,212,0.65);
}
.chat-empty {
  text-align:center;
  color:var(--muted,#96a3c8);
  font-size:13px;
  padding:40px 0;
}
.chat-divider {
  text-align:center;
  font-size:11px;
  color:rgba(177,193,223,0.6);
  letter-spacing:0.4px;
  text-transform:uppercase;
  display:flex;
  align-items:center;
  gap:10px;
}
.chat-divider::before,
.chat-divider::after {
  content:'';
  flex:1;
  height:1px;
  background:rgba(120,140,176,0.25);
}
.chat-row {
  display:flex;
  flex-direction:column;
  gap:6px;
  align-items:flex-start;
}
.chat-row.mine {
  align-items:flex-end;
}
.chat-meta {
  font-size:11px;
  color:rgba(166,183,217,0.7);
}
.chat-bubble {
  max-width:80%;
  padding:12px 14px;
  border-radius:12px;
  background:rgba(24,31,45,0.95);
  border:1px solid rgba(78,106,150,0.35);
  line-height:1.45;
  font-size:13px;
  box-shadow:0 10px 26px rgba(0,0,0,0.35);
  word-break:break-word;
}
.chat-row.mine .chat-bubble {
  background:linear-gradient(135deg, rgba(70,132,255,0.9), rgba(90,170,255,0.9));
  border-color:rgba(120,180,255,0.6);
  color:#06122a;
  box-shadow:0 12px 32px rgba(20,60,120,0.35);
}
.chat-message {
  white-space:pre-wrap;
}
.chat-attachments {
  margin-top:8px;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.chat-attach-card {
  border:1px solid rgba(80,110,150,0.35);
  border-radius:12px;
  overflow:hidden;
  background:rgba(12,16,24,0.85);
}
.chat-attach-links {
  font-size:12px;
  color:var(--muted,#97a4c0);
  line-height:1.45;
}
.chat-attach-links a {
  color:#9fc5ff;
  text-decoration:none;
}
.chat-attach-links a:hover { text-decoration:underline; }
.chat-input {
  display:flex;
  gap:10px;
  align-items:flex-end;
  background:rgba(10,14,22,0.9);
  border:1px solid rgba(70,96,140,0.4);
  border-radius:14px;
  padding:12px;
}
.chat-textarea {
  flex:1;
  min-height:80px;
  resize:vertical;
  border-radius:12px;
  border:1px solid rgba(86,105,132,0.6);
  background:rgba(18,24,33,0.95);
  color:var(--text,#e6e6e6);
  padding:10px 12px;
  font-size:13px;
  line-height:1.45;
  transition:border-color .2s ease, box-shadow .2s ease;
}
.chat-textarea:focus {
  outline:none;
  border-color:var(--accent,#4aa8ff);
  box-shadow:0 0 0 2px rgba(74,168,255,0.23);
  background:rgba(21,28,40,0.97);
}
.chat-send {
  border:none;
  background:linear-gradient(135deg, rgba(74,168,255,0.9), rgba(134,77,255,0.9));
  color:white;
  border-radius:12px;
  padding:12px 20px;
  font-weight:700;
  cursor:pointer;
  transition:transform .1s ease, box-shadow .2s ease;
}
.chat-send:hover {
  transform:translateY(-1px);
  box-shadow:0 12px 24px rgba(74,168,255,0.35);
}
.chat-status {
  min-height:18px;
  font-size:12px;
}

@media (max-width: 720px) {
  .chat-shell { padding:16px; }
  .chat-controls { flex-direction:column; align-items:stretch; }
  .chat-target-select { width:100%; min-width:0; }
  .chat-thread { height:44vh; }
  .chat-bubble { max-width:100%; }
  .chat-input { flex-direction:column; }
  .chat-textarea { width:100%; }
  .chat-send { width:100%; }
}

/* Buttons */
.btn.apply {
  background: var(--accent,#4aa8ff); color:#0d1117; font-weight:600; border:1px solid transparent;
}
.btn.apply:hover { background:#3697f7; }
.btn { cursor:pointer; }
.muted { color: var(--muted,#9aa7b4); }




/* Floating toast over the video */
/* Floating toast over the video — centered & larger */
#ytToast{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%, -50%);
  z-index: 9999;

  background: rgba(255, 176, 32, 0.95); /* warm amber */
  color:#051423;
  font-weight:800;
  border:1px solid #c98910;
  border-radius:14px;

  padding:14px 18px;
  font-size:18px;
  line-height:1.2;
  text-align:center;

  box-shadow:0 14px 36px rgba(0,0,0,.45);
  backdrop-filter: blur(4px);

  display:none;
  pointer-events:none;           /* don’t block clicks */
}


/* Team snapshot layout: bullets + compact alignment card side-by-side */
#statsTeamBox .team-snap {
  display: grid;
  grid-template-columns: 1fr minmax(260px, 360px);
  gap: 12px;
  align-items: start;
}

#statsTeamBox .team-bullets .stat-bullet { margin: 4px 0; }
#statsTeamBox .team-bullets .stat-track { width: 220px; height: 8px; }

#statsTeamBox .align-mini {
  padding: 8px 10px;
  border: 1px solid var(--border);
  border-radius: 10px;
  background: var(--panel);
  font-size: 12.5px;
}

#statsTeamBox .align-mini table { width:100%; border-collapse: collapse; }
#statsTeamBox .align-mini th,
#statsTeamBox .align-mini td {
  padding: 6px 6px;
  border-bottom: 1px solid var(--border);
}
#statsTeamBox .align-mini th { text-align: right; }
#statsTeamBox .align-mini th:first-child,
#statsTeamBox .align-mini td:first-child { text-align: left; }
#statsTeamBox .align-mini tr:last-child td { border-bottom: none; }

/* Mobile: stack vertically */
@media (max-width: 820px){
  #statsTeamBox .team-snap {
    grid-template-columns: 1fr;
  }
}



/* INSIGHTS: two+ columns, wrap nicely, responsive */
.pl-insights{
  display: grid !important;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 12px;
  align-items: stretch;
}

/* Make sure individual cards don’t expand to full width */
.pl-insights .insight{
  width: auto !important;
  box-sizing: border-box;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  padding: 10px;
  background: #fff;
  box-shadow: 0 1px 2px rgba(0,0,0,.05);
}

/* Titles & body */
.pl-insights .insight-title{
  font-weight: 600;
  margin-bottom: 6px;
}

.pl-insights .insight-body{
  color: #374151;
  line-height: 1.35;
}

/* Optional color accents by kind */
.pl-insights .insight.info{ border-left: 4px solid #3b82f6; }
.pl-insights .insight.success{ border-left: 4px solid #10b981; }
.pl-insights .insight.warn{ border-left: 4px solid #f59e0b; }
.pl-insights .insight.error{ border-left: 4px solid #ef4444; }







  /* Notes header bar */
  #notesHeader {
    display:flex; gap:8px; flex-wrap:wrap; align-items:center;
    padding:10px; border:1px solid var(--border); border-radius:12px;
    background:rgba(255,255,255,0.03);
    margin-bottom:10px;
  }
  #notesHeader .title {
    font-weight:600; margin-right:auto;
  }
  #notesHeader .select, #notesHeader input[type="date"], #notesHeader input[type="text"] {
    min-width:160px; height:34px;
  }
  #notesHeader .btn {
    height:34px; padding:0 12px; border-radius:10px;
  }

  /* Result cards */
  .note-row {
    padding:10px 0; border-bottom:1px dashed var(--border);
    display:grid; grid-template-columns: 160px 1fr; gap:12px;
  }
  .note-meta { font-size:12px; color:var(--muted); }
  .note-text { white-space:pre-wrap; }
  .filters-line { display:flex; gap:6px; flex-wrap:wrap; margin-top:6px; }



/* --- Notes Filters (dark theme) --- */
.notes-filters {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
  margin-bottom: 10px;
}

/* Inputs & selects */
.notes-filters select,
.notes-filters input[type="text"] {
  appearance: none;
  background: var(--bg2, #161b22);
  border: 1px solid var(--border, #2a3441);
  color: var(--text, #e6e6e6);
  border-radius: 10px;
  padding: 6px 34px 6px 10px; /* room for custom caret */
  font-size: 13px;
  height: 32px;
  min-width: 140px;
  line-height: 20px;
  transition: border-color 0.2s ease, background-color 0.2s ease;
}

/* Subtle hover/focus */
.notes-filters select:hover,
.notes-filters input[type="text"]:hover {
  border-color: var(--border-strong, #3a4759);
}
.notes-filters select:focus,
.notes-filters input[type="text"]:focus {
  outline: none;
  border-color: var(--accent, #4aa8ff);
  background: var(--bg, #14181f);
}

/* Dark placeholder */
.notes-filters input[type="text"]::placeholder {
  color: #9aa7b4;
}

/* Custom dropdown caret (light chevron) */
.notes-filters select {
  background-image:
    url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3e%3cpath fill='%23c9d1d9' d='M1.06.94a.75.75 0 0 1 1.06 0L5 3.81 7.88.94a.75.75 0 1 1 1.06 1.06L5.53 5.41a.75.75 0 0 1-1.06 0L1.06 2a.75.75 0 0 1 0-1.06z'/%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right 10px center;
  background-size: 10px 6px;
}

/* Hide IE arrow (legacy) */
.notes-filters select::-ms-expand { display: none; }

/* Buttons */
.notes-filters button {
  height: 32px;
  border: 1px solid transparent;
  border-radius: 10px;
  padding: 6px 14px;
  font-size: 13px;
  cursor: pointer;
  transition: background 0.15s ease, border-color 0.15s ease, opacity 0.15s ease;
}

/* Primary (Apply) */
.notes-filters button.apply {
  background: var(--accent, #4aa8ff);
  color: #0d1117;
  font-weight: 600;
}
.notes-filters button.apply:hover {
  background: #3697f7;
}

/* Ghost (Clear) */
.notes-filters button.clear {
  background: var(--bg2, #161b22);
  color: var(--text, #e6e6e6);
  border: 1px solid var(--border, #2a3441);
}
.notes-filters button.clear:hover {
  border-color: var(--border-strong, #3a4759);
}

/* Keep the pills looking consistent */
.tag {
  background: rgba(74, 168, 255, 0.15);
  border: 1px solid rgba(74, 168, 255, 0.35);
  color: #cfe8ff;
  border-radius: 999px;
  padding: 2px 8px;
  font-size: 12px;
  text-decoration: none;
}




/* Make inputs/selects reliably dark everywhere (even outside .notes-filters) */
select,
input[type="text"] {
  background: var(--bg2, #161b22);
  color: var(--text, #e6e6e6);
  border: 1px solid var(--border, #2a3441);
}

/* Global primary action button (Apply, Load more, etc.) */
button.apply,
#nMsg button.apply {
  background: var(--accent, #4aa8ff);
  color: #0d1117 !important;
  border: 1px solid #3a7fd6;
  border-radius: 10px;
  padding: 6px 14px;
  font-size: 13px;
  font-weight: 600;
  height: 32px;
  cursor: pointer;
  transition: background .15s ease, border-color .15s ease;
}
button.apply:hover,
#nMsg button.apply:hover {
  background: #3697f7;
  border-color: #2e6ec0;
}

/* Global secondary button (Clear, etc.) */
button.clear,
#nMsg button.clear {
  background: var(--bg2, #161b22);
  color: var(--text, #e6e6e6) !important;
  border: 1px solid var(--border, #2a3441);
  border-radius: 10px;
  padding: 6px 14px;
  font-size: 13px;
  height: 32px;
  cursor: pointer;
  transition: border-color .15s ease, background .15s ease;
}
button.clear:hover,
#nMsg button.clear:hover {
  border-color: var(--border-strong, #3a4759);
}

/* Ensure the footer button sits nicely next to the count */
#nMsg button.apply,
#nMsg button.clear {
  margin-left: 8px;
}



#teamAlignBox { display: none !important; }




/* --- Daily Ratings header layout --- */
.ratings-header {
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:8px;
}

.ratings-header h1 {
  margin:0;
  font-size:20px;
  font-weight:600;
  line-height:1.2;
}


.ratings-table-controls {
  display:flex;
  justify-content:flex-start;
  margin-bottom:8px;
}

.ratings-actions {
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;
}

.ratings-actions .btn.btn-small,
.ratings-header .btn.btn-small {
  height:30px;
  padding:0 12px;
  font-size:13px;
  border-radius:8px;
}

@media (max-width: 640px) {
  .ratings-table-controls {
    justify-content:flex-start;
  }
}




/* Clips grid */
.clips-grid {
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap:16px;
  margin-top:16px;
}
.clip-card {
  background:rgba(20,24,31,0.85);
  border:1px solid rgba(70,82,104,0.55);
  border-radius:14px;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  transition:transform .2s ease, box-shadow .2s ease;
}
.clip-card:hover {
  transform:translateY(-4px);
  box-shadow:0 14px 30px rgba(0,0,0,0.35);
}
.clip-card.selected {
  border-color:#4aa8ff;
  box-shadow:0 0 0 2px rgba(74,168,255,0.35);
}
.clip-thumb {
  position:relative;
  padding-top:56.25%;
  background:#0f131a;
  cursor:pointer;
}
.clip-thumb img {
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
}
.clip-thumb--empty{
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(80,90,120,0.25);
  color:#9aa5be;
  font-size:12px;
  font-weight:600;
}
.clip-actions {
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  gap:8px;
  align-items:center;
  justify-content:center;
  background:rgba(5,12,20,0.65);
  opacity:0;
  transition:opacity .2s ease;
  pointer-events:none;
}
.clip-actions .btn {
  pointer-events:auto;
  padding:6px 12px;
  font-size:12px;
}
.clip-card:hover .clip-actions,
.clip-card:focus-within .clip-actions {
  opacity:1;
}
.clip-body {
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.clip-title {
  font-weight:600;
  font-size:14px;
}
.clip-meta {
  font-size:12px;
  color:#9aa5be;
}
.clip-note {
  font-size:12px;
  color:#cfe3ff;
}
.clip-selection-count {
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:4px 10px;
  border-radius:999px;
  background:rgba(74,168,255,0.18);
  color:#cfe8ff;
  font-size:12px;
  margin-left:auto;
}
@media (max-width: 720px) {
  .clips-grid { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
  .clip-selection-count { margin-left: 0; }
}


/* === Sidebar (single source of truth) === */
:root{
  --sidebar-w: 220px;          /* expanded width */
  --sidebar-w-collapsed: 60px; /* collapsed rail width */
  --sidebar-gap: 8px;          /* space between sidebar and content */
}

/* Sidebar */
#sideNav{
  position: fixed; top:0; left:0; bottom:0;
  width: var(--sidebar-w);
  background: #14181f;
  border-right: 1px solid #2a3441;
  display:flex; flex-direction:column;
  z-index:100;
  transition: width .25s ease;
}
#sideNav .sideHeader{
  position: sticky; top:0;
  display:flex; align-items:center; justify-content:space-between;
  padding:12px 10px;
  border-bottom:1px solid #2a3441;
  background: inherit;
  z-index: 2;
}
#sideNav .sideLogo{ width:30px; height:30px; border-radius:6px; object-fit:contain; }
#sideNav .sideTitle{ color:#e6e6e6; font-weight:600; font-size:14px; }
#sideNav .collapseBtn{ border:0; background:none; color:#4aa8ff; font-size:16px; cursor:pointer; padding:0 4px; }

#sideNav .sideList{ flex:1; overflow-y:auto; padding:10px 0; }
#sideNav .sideSection{
  margin:6px;
  border:1px solid rgba(70,82,104,0.55);
  border-radius:10px;
  background:rgba(12,16,24,0.6);
  overflow:hidden;
}
#sideNav .sideSectionHeader{
  width:100%;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:6px;
  padding:8px 12px;
  font-size:12px;
  color:#9aa5be;
  background:none;
  border:0;
  cursor:pointer;
}
#sideNav .sideSectionChevron{ transition: transform .2s ease; transform:rotate(0deg); }
#sideNav .sideSectionBody{ padding:4px 0 8px; }
#sideNav .sideSectionBody .sideItem{ margin:2px 6px; }
#sideNav .sideSection.collapsed .sideSectionBody{ display:none; }
#sideNav .sideSection.collapsed .sideSectionChevron{ transform:rotate(-90deg); }
#sideNav .sideSectionHeader:focus-visible{ outline:2px solid #4aa8ff; outline-offset:2px; }
#sideNav .sideItem{
  padding:8px 14px; margin:2px 6px; border-radius:8px;
  color:#e6e6e6; cursor:pointer; transition:background .2s ease;
  white-space:nowrap; font-size:13px;
}
#sideNav .sideItem:hover{ background:rgba(255,255,255,.08); }
#sideNav .sideItem.active{ background:rgba(74,168,255,.18); color:#cfe8ff; font-weight:600; }

/* Only shift PANELS (and top tabs if present) — no extra margins anywhere else */
body.sidebar-enabled .panel,
body.sidebar-enabled .tabs{
  margin-left: calc(var(--sidebar-w) + var(--sidebar-gap));
  transition: margin-left .25s ease;
}

/* Collapsed mode: shrink bar, hide list (keep logo + arrow) */
#sideNav.collapsed{ width: var(--sidebar-w-collapsed); }
#sideNav.collapsed .sideTitle{ display:none; }
#sideNav.collapsed .sideList{ display:none; }

/* Content shift when collapsed */
body.sidebar-enabled.sidebar-collapsed .panel,
body.sidebar-enabled.sidebar-collapsed .tabs{
  margin-left: calc(var(--sidebar-w-collapsed) + var(--sidebar-gap));
}

/* Mobile: minimal shift */
@media (max-width: 900px){
  body.sidebar-enabled .panel,
  body.sidebar-enabled .tabs{
    margin-left: calc(var(--sidebar-w-collapsed) + 8px);
  }
  
  /* Make opponent report modal stack on smaller screens */
  #opponentReportModal > div > div[style*="grid-template-columns"] {
    grid-template-columns: 1fr !important;
  }
  #opponentReportModal > div {
    max-width: 95% !important;
    width: 95% !important;
  }
}





    </style>
  </head>

  <body class="sidebar-enabled desktop">
    <!-- Clip Modal -->
    <div id="clipModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:30000; align-items:center; justify-content:center;">
      <div id="clipModalCard" style="position:relative; width:90%; max-width:980px; background:#14181f; border:1px solid #2a3448; border-radius:12px; overflow:hidden;">






        <!-- Close -->
        <button onclick="closeClipModal()" style="position:absolute; top:10px; right:10px; z-index:3; background:#ff5a5f; border:0; color:white; font-weight:700; padding:6px 10px; border-radius:8px; cursor:pointer;">Close</button>

        <!-- Prev / Next -->
        <button onclick="prevClip()" class="btn" style="position:absolute; left:10px; top:50%; transform:translateY(-50%); z-index:2;">⏮ Prev</button>
        <button onclick="nextClip()" class="btn" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); z-index:2;">Next ⏭</button>

        <!-- Video -->
        <iframe id="clipFrame" src="" style="width:100%; height:560px; border:0;"
                allow="autoplay; encrypted-media" allowfullscreen
                referrerpolicy="no-referrer-when-downgrade"></iframe>


<div id="ytToast" role="status" aria-live="polite"></div>


        <!-- Footer: select toggle + notes input + Save + hint -->
        <div id="clipModalFooter" style="padding:10px; border-top:1px solid var(--border); background:#0f131a; display:flex; gap:8px; align-items:center;">
          <button id="clipSelectBtn" class="btn" onclick="toggleSelectCurrentClip()">Select clip</button>
          <span id="clipSelectedBadge" class="tag" style="display:none;">Selected</span>

          <input id="clipNoteInput" type="text" placeholder="Add a note (optional)"
                 class="select" style="flex:1; min-height:38px;" oninput="onClipNoteInput(event)">

         <button id="clipNoteSaveBtn" class="btn" type="button" onclick="saveClipNoteFromFooter()">Save note</button>
         <button class="btn" type="button" onclick="discussClip(encodeURIComponent(getCurrentClipUrl()))">Discuss in Chat</button>
<span id="clipNoteMsg" class="muted" style="min-width:110px; text-align:right;"></span>

          <span id="clipSelHint" class="muted" style="min-width:110px; text-align:right;"></span>
        </div>
      </div>
    </div>

    <div id="traitModal" class="trait-modal" aria-hidden="true">
      <div id="traitModalCard">
        <div id="traitModalHeader">
          <h2>Trait Ratings — Heat Map</h2>
          <button id="traitModalClose" type="button" aria-label="Close">×</button>
        </div>
        <div id="traitModalBody">
          <div id="traitModalMessage" class="muted">Loading…</div>
          <div class="ratingsWrap">
            <table id="traitTable"><thead></thead><tbody></tbody></table>
          </div>
          <div id="traitLegend" class="muted" style="margin-top:4px;"></div>
        </div>
      </div>
    </div>




<!-- Report Viewer Modal -->
<div id="reportModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.8); z-index:30010; align-items:center; justify-content:center;">
  <div style="position:relative; width:92%; max-width:1000px; background:#14181f; border:1px solid #2a3448; border-radius:12px; overflow:hidden;">
    <button onclick="closeReportModal()" style="position:absolute; top:10px; right:10px; z-index:3; background:#ff5a5f; border:0; color:white; font-weight:700; padding:6px 10px; border-radius:8px; cursor:pointer;">Close</button>
    <iframe id="reportFrame" src="" style="width:100%; height:78vh; border:0;" allow="autoplay; encrypted-media" referrerpolicy="no-referrer-when-downgrade"></iframe>
  </div>
</div>







<!-- Login overlay (unchanged wrapper) -->
<div id="loginOverlay" style="position:fixed;inset:0; background:#0b0d10; display:flex;align-items:center;justify-content:center; z-index:9999; overflow:hidden;">
  <img src="https://www.peristeribc.gr/wp-content/uploads/2025/07/Peristeri-Logo-plain-1.png"
       style="position:absolute;inset:0;margin:auto;opacity:0.08;width:90%;height:90%;object-fit:contain;pointer-events:none;" />
  <div style="background:rgba(20,24,31,0.95);padding:28px;border-radius:16px;text-align:center;z-index:1;max-width:320px; width:90%;">
    <h2 style="margin-bottom:16px;">Enter Password</h2>
    <input id="pwInput" type="password"
           style="padding:10px;width:100%;border-radius:8px;border:1px solid #2a3448;background:#0f131a;color:#e9edf6;" />
    <div style="height:12px;"></div>
    <button onclick="unlockAndStart()" style="padding:10px 14px;width:100%;border-radius:8px;border:0;background:#4aa8ff;color:#051423;font-weight:700;">
      Unlock
    </button>
    <div id="pwMsg" style="margin-top:10px;color:#ff5a5f;"></div>
  </div>
</div>

<!-- Hide the old top tab bar (kept for compatibility/rollback) -->
<style>.tabs { display:none !important; }</style>

<!-- SIDEBAR NAVIGATION -->
<nav id="sideNav">
  <div class="sideHeader">
    <img src="https://www.peristeribc.gr/wp-content/uploads/2025/07/Peristeri-Logo-plain-1.png" class="sideLogo">
    <span class="sideTitle">Peristeri BC</span>
    <button id="collapseNav" class="collapseBtn">⟨</button>
  </div>
  <div class="sideList">
    <div class="sideItem active" data-tab="home">🏠 Home</div>
    <div class="sideItem" data-tab="admin" id="adminTabItem" style="display:none;">⚙️ Admin Portal</div>
    <div class="sideSection" data-section="feedback">
      <button class="sideSectionHeader" type="button" aria-expanded="true">
        <span class="sideSectionLabel">Feedback</span>
        <span class="sideSectionChevron">⌃</span>
      </button>
      <div class="sideSectionBody">
        <div class="sideItem" data-tab="dailyratings">📊 Daily Ratings</div>
        <div class="sideItem" data-tab="notes">📝 Notes</div>
      </div>
    </div>
    <div class="sideSection" data-section="scouting">
      <button class="sideSectionHeader" type="button" aria-expanded="true">
        <span class="sideSectionLabel">Scouting</span>
        <span class="sideSectionChevron">⌃</span>
      </button>
      <div class="sideSectionBody">
        <div class="sideItem" data-tab="team">👥 Team</div>
        <div class="sideItem" data-tab="players">🏀 Players</div>
        <div class="sideItem" data-tab="opponents">📅 Schedule</div>
      </div>
    </div>
    <div class="sideSection" data-section="analytics">
      <button class="sideSectionHeader" type="button" aria-expanded="true">
        <span class="sideSectionLabel">Analytics</span>
        <span class="sideSectionChevron">⌃</span>
      </button>
      <div class="sideSectionBody">
        <div class="sideItem" data-tab="stats">📈 Stats</div>
        <div class="sideItem" data-tab="gamestats">📊 Game Stats</div>
        <div class="sideItem" data-tab="shotmap">🎯 Shot Map</div>
        <div class="sideItem" data-tab="predictions">🔮 Predictions</div>
      </div>
    </div>
    <div class="sideSection" data-section="media">
      <button class="sideSectionHeader" type="button" aria-expanded="true">
        <span class="sideSectionLabel">Media</span>
        <span class="sideSectionChevron">⌃</span>
      </button>
      <div class="sideSectionBody">
        <div class="sideItem" data-tab="clips">🎬 Clips</div>
        <div class="sideItem" data-tab="summaries">📹 Video Summaries</div>
      </div>
    </div>
    <div class="sideSection" data-section="operations">
      <button class="sideSectionHeader" type="button" aria-expanded="true">
        <span class="sideSectionLabel">Operations</span>
        <span class="sideSectionChevron">⌃</span>
      </button>
      <div class="sideSectionBody">
        <div class="sideItem" data-tab="strength">💪 Practice Load</div>
        <div class="sideItem" data-tab="chat">💬 Chat</div>
      </div>
    </div>
    <div class="sidePresence" id="presenceWidget">
      <div class="sidePresenceHeader">
        <span>Online now</span>
        <button class="presence-btn" type="button" title="Refresh" onclick="refreshPresenceWidget()">↻</button>
      </div>
      <div class="sidePresenceList" id="presenceWidgetList">
        <div class="presence-empty">Loading…</div>
      </div>
    </div>
  </div>
</nav>

<div id="mobileNavOverlay"></div>

<!-- Mobile tab bar -->
<div class="mobile-tabbar" id="mobileTabbar">
  <button type="button" data-mobile-nav="toggle" aria-label="Menu">☰<span>Menu</span></button>
  <button type="button" data-tab="home" class="active" aria-label="Home">🏠<span>Home</span></button>
  <button type="button" data-tab="players" aria-label="Players">🏀<span>Players</span></button>
  <button type="button" data-tab="clips" aria-label="Clips">🎬<span>Clips</span></button>
  <button type="button" data-tab="notes" aria-label="Notes">📝<span>Notes</span></button>
  <button type="button" data-tab="chat" aria-label="Chat">💬<span>Chat</span></button>
  <button type="button" data-tab="gamestats" aria-label="Game Stats">📊<span>Game Stats</span></button>
  <button type="button" data-tab="shotmap" aria-label="Shot Map">🎯<span>Shot Map</span></button>
</div>

<!-- HOME -->
<div id="panel-home" class="panel active home-panel">
  <div class="home-top">
    <div class="card" id="homeSessionCard">
      <div class="summary-card-header">
        <h2>Latest Session</h2>
        <button class="btn btn-small" type="button" onclick="loadHomeSummary(true)">Refresh</button>
      </div>
      <div id="homeSummaryTimestamp" class="muted" style="font-size:12px;"></div>
      <div id="homeSessionBody" class="muted">Loading…</div>
    </div>

    <div class="card" id="homeUpcomingCard">
      <div class="summary-card-header"><h2>Upcoming Games</h2></div>
      <div id="homeUpcomingList" class="upcoming-list">Loading…</div>
    </div>
  </div>

  <div class="card home-chart-card">
    <div class="sectionTitle" style="margin-bottom:6px; text-align:center;">Team Rating (avg of all players)</div>
    <div id="teamLineWrap" style="overflow:auto;">
      <svg id="teamLine"></svg>
    </div>
    <div id="teamLineNote" class="muted" style="margin-top:6px; text-align:center;"></div>
  </div>

  <div class="card home-flags-card">
    <div class="sectionTitle">Team — 3-Day Flags</div>
    <div class="ratingsWrap">
      <table id="flagsTable"><thead></thead><tbody></tbody></table>
    </div>
    <div id="flagsMsg" class="muted" style="margin-top:8px;"></div>
  </div>
</div>

<div id="panel-team" class="panel">
  <h1>Team — Last 7 Days</h1>

  <div id="teamBox" class="grid" style="grid-template-columns:1fr 1fr; gap:18px;"></div>


  <!-- Theme Frequency card (STAYS inside panel-team) -->
  <div id="teamClipThemes" class="card" style="margin-top:16px;">
    <div class="sectionTitle">Theme Frequency (last 7 days)</div>
    <div id="themeChips"></div>
  </div>
</div> <!-- close panel-team once -->

<!-- DAILY RATINGS -->
<div id="panel-dailyratings" class="panel">
  <div class="ratings-header">
    <h1>Daily Ratings — Heat Map</h1>
  </div>

  <div class="ratingsWrap">
    <div class="ratings-table-controls">
      <div class="ratings-actions">
        <button id="openRatingsBtn" class="btn btn-small">Rate session</button>
        <button id="openTraitBtn" class="btn btn-small" type="button">Trait ratings</button>
      </div>
    </div>
    <table id="ratingsTable"><thead></thead><tbody></tbody></table>
  </div>

  <div id="ratingsLegend" class="muted" style="margin-top:8px;"></div>
</div>

<div id="panel-gamestats" class="panel">
  <h1>Game Stats</h1>
  <div class="gamestats-controls">
    <select id="gsGame">
      <option value="">Select game</option>
    </select>
    <button id="gsLoadBtn" type="button">Load</button>
  </div>
  <div class="gamestats-summary">
    <div class="gs-card">
      <div class="gs-meta" id="gsGameMeta">
        <strong>No game loaded</strong>
        <span>Select a game to view details.</span>
      </div>
    </div>
    <div class="gs-card">
      <h3 style="margin:0;">Advanced Snapshot</h3>
      <ul id="gsAdvancedMetrics" class="gs-metric-list"></ul>
    </div>
    <div class="gs-card">
      <h3 style="margin:0;">Key Notes</h3>
      <ul id="gsInsights" class="gs-metric-list"></ul>
    </div>
  </div>
  <div class="gamestats-charts">
    <div class="gamestats-section chart-duo">
      <h2>Four Factors</h2>
      <canvas id="gsFourChart" class="gs-chart-square"></canvas>
    </div>
    <div class="gamestats-section chart-duo">
      <h2>Shot Profile</h2>
      <canvas id="gsShotChart" class="gs-chart-square"></canvas>
    </div>
    <div class="gamestats-section chart-span">
      <h2>Game Flow</h2>
      <div class="gamestats-canvas-wrap">
        <canvas id="gsFlowChart"></canvas>
      </div>
    </div>
    <div class="gamestats-section chart-span">
      <h2>Usage vs Efficiency</h2>
      <div class="gamestats-canvas-wrap">
        <canvas id="gsUsageChart"></canvas>
      </div>
    </div>
  </div>
  <div id="gsMessage" class="muted" style="margin-top:8px;"></div>
</div>

<div id="panel-shotmap" class="panel">
  <div class="shotmap-header">
    <h1 style="margin:0;font-size:22px;">Shot Map — Hex Heatmap</h1>
    <div class="shotmap-meta">
      <span id="shot-meta">Loading…</span>
      <button id="shot-exportBtn" type="button" class="btn btn-small">Export PNG</button>
    </div>
  </div>

  <div class="shotmap-layout">
    <aside class="shotmap-filter">
      <h3>Filters</h3>
      <div class="shotmap-group">
        <label>
          <span>Game</span>
          <select id="shot-game">
            <option value="">All games</option>
          </select>
        </label>
        <label>
          <span>Player</span>
          <select id="shot-player"></select>
        </label>
        <label>
          <span>Opponent</span>
          <select id="shot-opponent"></select>
        </label>
        <label>
          <span>Period</span>
          <select id="shot-period"></select>
        </label>
        <label>
          <span>Type</span>
          <select id="shot-type">
            <option value="">All types</option>
            <option value="2pt">2pt</option>
            <option value="3pt">3pt</option>
          </select>
        </label>
        <label>
          <span>Result</span>
          <select id="shot-result">
            <option value="">All results</option>
            <option value="1">Made</option>
            <option value="0">Miss</option>
          </select>
        </label>
      </div>

      <h3>Render</h3>
      <div class="shotmap-group">
        <label>
          <span>Mode</span>
          <select id="shot-render">
            <option value="dots">Dots</option>
            <option value="hex" selected>Hex heatmap</option>
          </select>
        </label>
        <label>
          <span>Color by</span>
          <select id="shot-colorBy">
            <option value="fg">FG%</option>
            <option value="xfg" selected>xFG% (smoothed)</option>
            <option value="ep">EP (Expected Points)</option>
            <option value="density">Shot density</option>
          </select>
        </label>
      </div>

      <h3>Hex & Dot Settings</h3>
      <div class="shotmap-group">
        <label>
          <span>Hex size</span>
          <input id="shot-hexSize" type="range" min="12" max="60" step="1" value="28">
        </label>
        <label>
          <span>Smoothing</span>
          <div class="shotmap-inline">
            <input id="shot-smoothK" type="range" min="0" max="30" step="1" value="8">
            <span id="shot-kLabel">k=8</span>
          </div>
        </label>
        <label>
          <span>Brightness</span>
          <input id="shot-hexBright" type="range" min="100" max="170" step="5" value="130">
        </label>
        <label>
          <span>Dot size</span>
          <input id="shot-markerSize" type="range" min="3" max="10" step="0.5" value="5">
        </label>
      </div>

      <h3>Court</h3>
      <div class="shotmap-group">
        <label class="shotmap-inline">
          <span>
            <input id="shot-shadeToggle" type="checkbox" checked>
            Shade court
          </span>
          <span id="shot-shadePct">35%</span>
        </label>
        <input id="shot-shadeOpacity" type="range" min="0" max="80" step="1" value="35">
      </div>

      <button id="shot-resetBtn" type="button" class="btn btn-small">Reset</button>
    </aside>

    <section class="shotmap-center">
      <div id="shot-stage" class="shot-stage">
        <div id="shot-courtBg" class="shot-stage-layer"></div>
        <div id="shot-courtShade" class="shot-stage-layer" aria-hidden="true"></div>
        <canvas id="shot-canvas" class="shot-stage-layer"></canvas>
      </div>

      <div class="shot-badges">
        <span class="badge" id="shot-totalBadge">0 shots</span>
        <span class="badge" id="shot-madeBadge">0 made</span>
        <span class="badge" id="shot-pctBadge">0%</span>
        <span class="badge" id="shot-legendUnit">Color: xFG% (0→100)</span>
        <span class="badge" id="shot-baselines">2PT • — | 3PT • —</span>
      </div>

      <div class="shot-legend">
        <span><span class="dot" style="background:#12b886;border:1px solid #0c8c68;"></span>Made</span>
        <span><span class="dot" style="background:#fa5252;border:1px solid #d63333;"></span>Miss</span>
        <span><span class="ring"></span>3PT ring</span>
        <span class="muted">Hex opacity follows volume (density mode uses color scale)</span>
        <span class="swatch" id="shot-swatch" style="background:linear-gradient(90deg,#ff4040,#ffd000,#00dc82)"></span>
        <span class="muted" id="shot-swatchLabel">Low → High</span>
      </div>
    </section>

    <aside class="shotmap-stats">
      <div class="card-section">
        <h4>Filter Summary</h4>
        <div id="shot-filterSummary" style="font-size:13px;color:#d7e1ff;">Loading…</div>
      </div>
      <div class="card-section">
        <h4>Aggregate Stats</h4>
        <div id="shot-aggKvs"></div>
      </div>
      <div class="card-section">
        <h4>Shot Distribution</h4>
        <div class="shot-dist-bars" id="shot-distBars"></div>
      </div>
      <div class="card-section">
        <h4>Additional Stats</h4>
        <div class="shot-dist-bars" id="shot-addlStats"></div>
      </div>
      <div class="card-section">
        <h4>Zone Leaders</h4>
        <div id="shot-zoneLeaders" class="shot-dist-bars"></div>
      </div>
    </aside>
  </div>
  <div id="shot-tip" class="shot-tip"></div>
</div>

<!-- PREDICTIONS -->
<div id="panel-predictions" class="panel">
  <div class="sectionTitle" style="margin-top:0;">🔮 Predictions</div>
  
  <div id="predictionMsg" class="muted" style="margin-bottom:8px;">Click "Generate Prediction" to analyze next game.</div>
  
  <div style="margin-bottom:24px;">
    <button id="loadPredictionBtn" class="btn" type="button">Generate Prediction</button>
  </div>
  
  <div id="predictionContent" style="display:none;">
    <!-- Game Info -->
    <div class="card" style="margin-bottom:24px; padding:16px; border:1px solid var(--border); border-radius:12px;">
      <div class="muted" style="font-size:11px; margin-bottom:8px;">Next Game</div>
      <div id="predOpponent" style="font-size:24px; font-weight:700; margin-bottom:4px;">—</div>
      <div id="predDate" class="muted" style="font-size:14px;">—</div>
    </div>
    
    <!-- How it Works -->
    <div style="margin-bottom:16px; padding:12px; background:var(--accent-light); border-radius:8px; border-left:3px solid var(--accent);">
      <div style="font-weight:600; font-size:13px; margin-bottom:6px; color:var(--accent);">💡 How This Works</div>
      <div class="muted" style="font-size:12px; line-height:1.6;">
        Predictions are based on <strong>recent practice ratings</strong> and <strong>historical game performance</strong>. 
        The model analyzes your last 3 practice sessions' average ratings and compares them with shooting efficiency in recent games. 
        <br><br>
        <strong>Points range</strong> (e.g., 82-88) shows the expected scoring based on historical variance. 
        <strong>Quarter breakdown</strong> predicts performance by period using recent game patterns.
      </div>
    </div>
    
    <!-- Predictions Grid -->
    <div class="card" style="margin-bottom:24px; padding:16px; border:1px solid var(--border); border-radius:12px;">
      <div class="sectionTitle" style="margin:0 0 16px 0;">Shooting Efficiency</div>
      <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:16px;">
        <div>
          <div class="muted" style="font-size:12px;">Total FG%</div>
          <div id="predFG" style="font-size:28px; font-weight:700; color:var(--accent);">—%</div>
          <div id="predConfidence" class="muted" style="font-size:12px; margin-top:4px;">—</div>
        </div>
        <div>
          <div class="muted" style="font-size:12px;">2-Point FG%</div>
          <div id="predFG2" style="font-size:24px; font-weight:600;">—%</div>
        </div>
        <div>
          <div class="muted" style="font-size:12px;">3-Point FG%</div>
          <div id="predFG3" style="font-size:24px; font-weight:600;">—%</div>
        </div>
      </div>
    </div>
    
    <!-- Game Outcome -->
    <div class="card" style="margin-bottom:24px; padding:16px; border:1px solid var(--border); border-radius:12px;">
      <div class="sectionTitle" style="margin:0 0 16px 0;">Expected Outcome</div>
      <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:16px;">
        <div>
          <div class="muted" style="font-size:12px;">Points Scored</div>
          <div id="predPoints" style="font-size:28px; font-weight:700; color:var(--accent);">—</div>
          <div class="muted" style="font-size:12px; margin-top:4px;">points</div>
        </div>
        <div>
          <div class="muted" style="font-size:12px;">Result</div>
          <div id="predWinLoss" style="font-size:28px; font-weight:700;">—</div>
          <div id="predWinProb" class="muted" style="font-size:12px; margin-top:4px;">—</div>
        </div>
      </div>
    </div>
    
    <!-- Quarter-by-Quarter Breakdown -->
    <div class="card" style="margin-bottom:24px; padding:16px; border:1px solid var(--border); border-radius:12px; display:none;" id="predQuartersCard">
      <div class="sectionTitle" style="margin:0 0 16px 0;">Quarter-by-Quarter Breakdown</div>
      
      <div style="margin-bottom:16px;">
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:8px;">
          <div style="padding:8px; background:var(--bg-secondary); border-radius:6px;">
            <div class="muted" style="font-size:11px;">1st Half</div>
            <div id="predHalf1" style="font-size:18px; font-weight:600;">—</div>
          </div>
          <div style="padding:8px; background:var(--bg-secondary); border-radius:6px;">
            <div class="muted" style="font-size:11px;">2nd Half</div>
            <div id="predHalf2" style="font-size:18px; font-weight:600;">—</div>
          </div>
        </div>
      </div>
      
      <div style="display:grid; grid-template-columns:repeat(4, 1fr); gap:8px;">
        <div style="padding:8px; background:var(--bg-secondary); border-radius:6px; text-align:center;">
          <div class="muted" style="font-size:11px;">Q1</div>
          <div id="predQ1" style="font-size:16px; font-weight:600;">—</div>
        </div>
        <div style="padding:8px; background:var(--bg-secondary); border-radius:6px; text-align:center;">
          <div class="muted" style="font-size:11px;">Q2</div>
          <div id="predQ2" style="font-size:16px; font-weight:600;">—</div>
        </div>
        <div style="padding:8px; background:var(--bg-secondary); border-radius:6px; text-align:center;">
          <div class="muted" style="font-size:11px;">Q3</div>
          <div id="predQ3" style="font-size:16px; font-weight:600;">—</div>
        </div>
        <div style="padding:8px; background:var(--bg-secondary); border-radius:6px; text-align:center;">
          <div class="muted" style="font-size:11px;">Q4</div>
          <div id="predQ4" style="font-size:16px; font-weight:600;">—</div>
        </div>
      </div>
    </div>
    
    <!-- Historical Accuracy -->
    <div class="card" style="margin-bottom:24px; padding:16px; border:1px solid var(--border); border-radius:12px; display:none;" id="predAccuracyCard">
      <div class="sectionTitle" style="margin:0 0 16px 0;">Historical Accuracy</div>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
        <div>
          <div class="muted" style="font-size:12px;">Avg Prediction Error</div>
          <div id="predAvgError" style="font-size:20px; font-weight:600;">—</div>
          <div class="muted" style="font-size:11px; margin-top:4px;">± points</div>
        </div>
        <div>
          <div class="muted" style="font-size:12px;">Games Analyzed</div>
          <div id="predGamesCount" style="font-size:20px; font-weight:600;">—</div>
        </div>
      </div>
    </div>
    
    <!-- Breakdown -->
    <div id="predBreakdown" style="margin-top:12px;"></div>
  </div>
  
  <!-- Past Games History -->
  <div id="predPastGames" class="card" style="margin-bottom:24px; padding:16px; border:1px solid var(--border); border-radius:12px; display:none;"></div>
</div>

<!-- PLAYERS -->
<div id="panel-players" class="panel">
  <div class="grid g2">
    <div class="card">
      <label class="muted">Player</label>
      <select id="playerSelect" class="select" onchange="onPlayerChange(this.value)"></select>
      <div id="playerPhotoWrap" style="margin-top:10px;">
        <img id="playerPhoto" class="avatar" alt="Player photo" />
      </div>
      <div class="kv">
        <div>Overall delta</div><div id="pOverall" class="mono">—</div>
      </div>
      <div class="sectionTitle">3-Day Flags</div>
      <div id="pFlags" class="mono muted">—</div>
      <div class="sectionTitle">Ratings by Coach</div>
      <div id="pCoachRatings" class="mono muted">—</div>
    </div>

    <div class="card">
      <h2>Strengths</h2>
      <ul id="pStrengths"></ul>
      <h2>Areas to Improve</h2>
      <ul id="pWeaknesses"></ul>
      <h2>Suggested Focus</h2>
      <ul id="pFocus"></ul>

      <div class="sectionTitle">Shot Chart</div>
      <div id="pShotChartWrap" class="player-shot-wrap">
        <canvas id="pShotCanvas" width="320" height="300"></canvas>
        <div id="pShotSummary" class="muted" style="font-size:12px;">No shot data.</div>
      </div>

      <div class="sectionTitle">Clips (newest)</div>
      <div id="pClips"></div>
    </div>
  </div>
</div>


<!-- stats -->
<section id="panel-stats" class="panel">
  <div class="sectionTitle" style="margin-top:0;">Stats</div>

  <div id="statsMsg" class="muted" style="margin-bottom:8px;">Loading…</div>

  <!-- League scatter -->
  <div id="statsTeamBox" class="card" style="padding:10px;margin-bottom:12px; border:1px solid var(--border); border-radius:12px;">
    <div style="font-weight:600; margin-bottom:6px;">League ORtg vs DRtg</div>
    <div class="muted" data-role="league-note" style="font-size:12px; margin-bottom:6px;">Bubble size reflects net rating (eDiff). Look for top-right bubbles (high ORtg, low DRtg) to spot elite teams.</div>
    <div class="league-scatter-wrap"><canvas id="statsLeagueChart"></canvas></div>
  </div>

  <!-- Opponent profiler -->
  <div class="card stats-opp-card" style="margin-bottom:12px; border:1px solid var(--border); border-radius:12px;">
    <div style="font-weight:600; display:flex; flex-wrap:wrap; gap:10px; align-items:center;">
      <span>Opponent profile vs league & Peristeri</span>
      <div style="display:flex; align-items:center; gap:6px;">
        <label for="statsOpponentSelect" class="muted" style="font-size:12px;">Opponent</label>
        <select id="statsOpponentSelect" class="select" style="width:200px;"></select>
      </div>
    </div>
    <div id="statsOpponentProfile" class="muted" style="font-size:13px;">
      Pick a team to compare key metrics against league averages and Peristeri BC.
    </div>
  </div>

  <!-- Players table -->
  <div class="sectionTitle">Player insights</div>
  <div class="muted" style="margin-bottom:6px;">Derived per-40, shot profile, advanced join + flags</div>
  <div style="overflow:auto;">
    <table id="statsPlayersTable" class="table">
      <thead>
        <tr>
          <th>Player</th><th>MPG</th><th>PPG</th><th>FGA</th><th>3PM</th><th>3PA</th><th>3PAr</th><th>FTr</th>
          <th>PPS</th><th>TS%</th><th>USG%</th><th>TOV%</th><th>ORtg</th><th>eDiff</th><th>PER</th>
          <th>Per40 PTS</th>
<th>Per40 REB</th>
<th>Per40 AST</th>
<th>Per40 Stocks</th>
          
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Leaderboards -->
  <div class="sectionTitle">Leaderboards</div>
  <div id="statsLeaders" class="grid" style="display:grid; grid-template-columns: repeat(auto-fit,minmax(240px,1fr)); gap:10px;"></div>

  <!-- Practice-to-Game Correlation -->
  <div class="card" style="margin-top:24px; padding:16px; border:1px solid var(--border); border-radius:12px;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
      <div class="sectionTitle" style="margin:0;">Practice-to-Game Performance</div>
      <button id="loadPracticeGameBtn" class="btn btn-small" type="button">Load Analysis</button>
    </div>
        <div class="muted" style="font-size:13px; margin-bottom:12px;">
          Correlation: Average of last 3 practice ratings → Team FG% in games. Also shows game day rating for comparison.
        </div>
        <div id="practiceGameMsg" class="muted" style="margin-bottom:8px;">Click "Load Analysis" to generate report.</div>
    <div id="practiceGameSummary" style="display:none; margin-bottom:16px; padding:12px; background:var(--bg-secondary); border-radius:8px;">
      <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:12px;">
        <div>
          <div class="muted" style="font-size:12px;">Total Games</div>
          <div id="pgTotalGames" style="font-size:20px; font-weight:600;">—</div>
        </div>
        <div>
          <div class="muted" style="font-size:12px;">Practice → Game FG% Corr</div>
          <div id="pgCorrelation" style="font-size:20px; font-weight:600;">—</div>
        </div>
      </div>
    </div>
    <div id="practiceGameContent"></div>
  </div>
</section>








<!-- CLIPS -->
<div id="panel-clips" class="panel">
  <div class="filters">
    <select id="fPlayer"></select>
    <select id="fTheme"></select>
    <select id="fSub"></select>
    <input id="fSearch" type="text" placeholder="Search text…" />
    <button class="btn" onclick="loadClips()">Search</button>
    <button class="btn-danger" onclick="openFeedbackModal()">Email Feedback</button>
    <button class="btn" onclick="openCreateSummaryModal()">Create indiv. Summary</button>
    <button class="btn" onclick="discussSelectedClips()">Discuss Selected</button>
    <button class="btn" onclick="deselectAllClips()">Deselect All</button>
    <span id="clipSelectionCount" class="clip-selection-count">Selected: 0</span>
  </div>
  <div id="clipsList" class="clips-grid"></div>
</div>

<!-- Feedback Compose Modal -->
<div id="feedbackModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.75); z-index:10001; align-items:center; justify-content:center;">
  <div style="background:#14181f; border:1px solid #2a3448; border-radius:12px; width:90%; max-width:680px; padding:16px; position:relative;">
    <button onclick="closeFeedbackModal()" style="position:absolute; right:12px; top:12px; border:0; background:#ff5a5f; color:white; font-weight:700; padding:6px 10px; border-radius:8px; cursor:pointer;">Close</button>

    <h2 style="margin-top:0;">Email feedback</h2>

        <div style="display:grid; gap:10px;">
          <label>Player
            <select id="fbPlayer" class="select"></select>
          </label>

          <label>Message to player
            <textarea id="fbText" rows="6" style="width:100%; padding:10px; border-radius:10px; background:#0f131a; color:var(--text); border:1px solid var(--border);"></textarea>
          </label>

          <div class="muted" id="fbSelectedCount">No clips selected.</div>

          <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:8px;">
            <button class="btn" onclick="sendFeedback()" id="fbSendBtn">Send</button>
          </div>

          <div id="fbMsg" class="muted"></div>
        </div>
      </div>
    </div>

    <!-- Create Summary Modal -->
    <div id="createSummaryModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.75); z-index:10003; align-items:center; justify-content:center;">
      <div style="background:#14181f; border:1px solid #2a3448; border-radius:12px; width:92%; max-width:820px; padding:16px; position:relative; max-height:92vh; overflow:auto;">
        <button onclick="closeCreateSummaryModal()" style="position:absolute; right:12px; top:12px; border:0; background:#ff5a5f; color:white; font-weight:700; padding:6px 10px; border-radius:8px; cursor:pointer;">Close</button>

        <h2 style="margin-top:0;">Create Summary</h2>

        <div class="grid" style="grid-template-columns:1fr 1fr; gap:12px;">
          <label>Title
            <input id="sumTitle" type="text" class="select" placeholder="e.g., 12 Feb — Transition Defense" />
          </label>
          <label>Audience type
            <select id="sumAudienceType" class="select" onchange="onSumAudienceTypeChange()">
              <option value="player">Player</option>
              <option value="team">Team</option>
              <option value="group">Group</option>
            </select>
          </label>
          <label id="sumAudienceNameWrap">Audience name
            <select id="sumAudienceName" class="select"></select>
          </label>
          <label>Description
            <textarea id="sumDescription" rows="3" style="width:100%; padding:10px; border-radius:10px; background:#0f131a; color:var(--text); border:1px solid var(--border);" placeholder="Optional context for the reel"></textarea>
          </label>
        </div>

        <div class="sectionTitle" style="margin-top:12px;">Selected Clips & Captions</div>
        <div class="ratingsWrap">
          <table id="sumClipsTable">
            <thead><tr><th style="text-align:center;">#</th><th>Clip</th><th>Caption (optional)</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="sumMsg" class="muted" style="margin-top:8px;"></div>

        <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
          <button class="btn" id="sumSaveBtn" onclick="saveSummary()">Save Summary</button>
        </div>
      </div>
    </div>

    <!-- Summary View Modal -->
    <div id="summaryViewModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.75); z-index:10002; align-items:center; justify-content:center;">
      <div style="background:#14181f; border:1px solid #2a3448; border-radius:12px; width:92%; max-width:820px; padding:16px; position:relative; max-height:92vh; overflow:auto;">
        <button onclick="closeSummaryModal()" style="position:absolute; right:12px; top:12px; border:0; background:#ff5a5f; color:white; font-weight:700; padding:6px 10px; border-radius:8px; cursor:pointer;">Close</button>
        <h2 id="svTitle" style="margin-top:0;">Summary</h2>
        <div class="muted" id="svMeta"></div>
        <p id="svDesc" style="white-space:pre-wrap;"></p>

        <div class="ratingsWrap">
          <table id="svClipsTable">
            <thead>
              <tr><th style="text-align:center;">#</th><th>Clip</th><th>Caption</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="svMsg" class="muted" style="margin-top:8px;"></div>
      </div>
    </div>

<!-- SUMMARIES -->
<div id="panel-summaries" class="panel">
  <h1>Summaries</h1>
  <div class="ratingsWrap">
    <table id="sumListTable">
      <thead>
        <tr>
          <th style="text-align:center;">Date</th>
          <th>Title</th>
          <th>Audience</th>
          <th style="text-align:center;">Open</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div id="sumListMsg" class="muted" style="margin-top:8px;"></div>
</div>

 






<div id="panel-chat" class="panel">
  <div class="chat-shell">
    <div class="chat-header">
      <div>
        <h2>Coach Chat</h2>
        <p>Share quick updates, reminders, and links with the staff.</p>
      </div>
      <button class="chat-refresh" type="button" onclick="refreshChat()">↻ Refresh</button>
    </div>

    <div class="chat-controls">
      <div class="chat-control-group">
        <span class="chat-label">Send to</span>
        <select id="chatTo" class="chat-target-select">
          <option value="All">All coaches</option>
        </select>
      </div>
    </div>

    <div id="chatList" class="chat-thread">
      <div class="chat-empty">No messages yet.</div>
    </div>

    <div class="chat-input">
      <textarea id="chatText" rows="3" class="chat-textarea" placeholder="Write a note to this coach (or All coaches)…"></textarea>
      <button class="chat-send" type="button" onclick="sendChat()">Send</button>
    </div>

    <div class="chat-status muted" id="chatMsg"></div>
  </div>
</div>


<div id="opponentReportModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.75); z-index:10050; align-items:center; justify-content:center; overflow:auto; padding:20px;">
  <div style="background:#14181f; border:1px solid #2a3448; border-radius:12px; width:95%; max-width:1200px; padding:16px; position:relative; display:flex; flex-direction:column; gap:12px; max-height:90vh; overflow:auto;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:4px;">
      <div>
    <h2 style="margin:0;">Opponent Statistical Report</h2>
        <div class="muted" style="font-size:12px; margin-top:4px;">Copy and share the generated report with staff.</div>
      </div>
      <button onclick="closeOpponentReport()" style="border:0; background:#ff5a5f; color:white; font-weight:700; padding:8px 16px; border-radius:8px; cursor:pointer; flex-shrink:0;">Close</button>
    </div>
    <div style="display:grid; grid-template-columns:1.5fr 1fr; gap:12px; align-items:start;">
      <div style="display:flex; flex-direction:column; gap:8px;">
        <textarea id="opponentReportText" style="width:100%; height:400px; max-height:60vh; background:#0b0d10; color:#dce5ff; border:1px solid #2a3448; border-radius:8px; padding:10px; font-size:13px; line-height:1.5; white-space:pre-wrap; resize:vertical; font-family:monospace;"></textarea>
    <div style="display:flex; gap:8px; justify-content:flex-end;">
      <button class="btn" type="button" onclick="copyOpponentReport(this)">Copy to clipboard</button>
    </div>
      </div>
      <div id="opponentReportRanks" style="background:#0f131a; border:1px solid #2a3448; border-radius:10px; padding:12px; overflow:auto; max-height:60vh;">
      <div class="muted" style="font-size:12px;">Load an opponent to view league ranking table.</div>
      </div>
    </div>
  </div>
</div>








<div id="notesTooltip" style="
  position: fixed;
  z-index: 100000;
  display: none;
  max-width: 360px;
  background: rgba(20,24,31,0.98);
  color: #e9edf6;
  border: 1px solid #2a3448;
  border-radius: 10px;
  padding: 10px;
  box-shadow: 0 8px 24px rgba(0,0,0,.4);
  pointer-events: none;
  font-size: 13px;
  line-height: 1.35;
"></div>




<div id="panel-opponents" class="panel">
  <h1>Shedule</h1>
  <div class="card" id="oppScheduleCard">
    <div class="sectionTitle">Upcoming & Past Games</div>
    <div id="oppScheduleList">Loading…</div>
  </div>
</div>

<!-- ADMIN PORTAL -->
<div id="panel-admin" class="panel" style="background:#0f131a; color:#e9edf6;">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
    <h1 style="margin:0; color:#e9edf6;">Admin Portal</h1>
    <button onclick="loadAdminStats()" class="btn" style="flex-shrink:0;">Refresh</button>
  </div>

  <div id="adminSummary" class="card" style="margin-bottom:20px; padding:16px; border:1px solid var(--border); border-radius:12px; background:#14181f;">
    <div class="sectionTitle" style="margin-top:0; color:#e9edf6;">Summary</div>
    <div id="adminSummaryContent" class="muted" style="color:#a0a8b8;">Loading...</div>
  </div>

  <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:20px;">
    <div class="card" style="padding:16px; border:1px solid var(--border); border-radius:12px; background:#14181f;">
      <div class="sectionTitle" style="margin-top:0; color:#e9edf6;">Coach Leaderboard</div>
      <div id="adminLeaderboard" class="muted" style="color:#a0a8b8;">Loading...</div>
    </div>

    <div class="card" style="padding:16px; border:1px solid var(--border); border-radius:12px; background:#14181f;">
      <div class="sectionTitle" style="margin-top:0; color:#e9edf6;">Feature Usage</div>
      <div id="adminFeatureUsage" class="muted" style="color:#a0a8b8;">Loading...</div>
    </div>
  </div>

  <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:20px;">
    <div class="card" style="padding:16px; border:1px solid var(--border); border-radius:12px; background:#14181f;">
      <div class="sectionTitle" style="margin-top:0; color:#e9edf6;">Player Coverage</div>
      <div id="adminPlayerCoverage" class="muted" style="color:#a0a8b8; max-height:400px; overflow:auto;">Loading...</div>
    </div>

    <div class="card" style="padding:16px; border:1px solid var(--border); border-radius:12px; background:#14181f;">
      <div class="sectionTitle" style="margin-top:0; color:#e9edf6;">Recent Activity Log</div>
      <div id="adminRecentActivity" class="muted" style="max-height:400px; overflow:auto; color:#a0a8b8;">Loading...</div>
    </div>
  </div>

  <div class="card" style="padding:16px; border:1px solid var(--border); border-radius:12px; background:#14181f;">
    <div class="sectionTitle" style="margin-top:0; color:#e9edf6;">Login/Logout History</div>
    <div id="adminSessions" class="muted" style="max-height:400px; overflow:auto; color:#a0a8b8;">Loading...</div>
  </div>
</div>

<!-- User Detail Modal -->
<div id="userDetailModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.75); z-index:10060; align-items:center; justify-content:center; overflow:auto; padding:20px;">
  <div style="background:#14181f; border:1px solid #2a3448; border-radius:12px; width:95%; max-width:900px; padding:16px; position:relative; display:flex; flex-direction:column; gap:12px; max-height:90vh; overflow:auto;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:4px;">
      <h2 style="margin:0; color:#e9edf6;" id="userDetailName">User Details</h2>
      <button onclick="closeUserDetail()" style="border:0; background:#ff5a5f; color:white; font-weight:700; padding:8px 16px; border-radius:8px; cursor:pointer; flex-shrink:0;">Close</button>
    </div>
    <div id="userDetailContent" style="color:#a0a8b8;">Loading...</div>
  </div>
</div>

<!-- STRENGTH / PRACTICE LOAD -->
<div id="panel-strength" class="panel">
  <h1>Practice Load</h1>

  <div class="ratingsWrap">
    <table id="plListTable">
      <thead>
        <tr>
          <th style="text-align:center;">Date</th>
          <th>Title</th>
          <th>Audience</th>
          <th style="text-align:center;">Open</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div id="plListMsg" class="muted" style="margin-top:8px;"></div>
</div>
<!-- Practice Load View Modal -->
<div id="plViewModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.75); z-index:10005; align-items:center; justify-content:center;">
  <div style="background:#14181f; border:1px solid #2a3448; border-radius:12px; width:92%; max-width:860px; padding:16px; position:relative; max-height:92vh; overflow:auto;">
    <button onclick="closePLModal()" style="position:absolute; right:12px; top:12px; border:0; background:#ff5a5f; color:white; font-weight:700; padding:6px 10px; border-radius:8px; cursor:pointer;">Close</button>

    <h2 id="plTitle" style="margin-top:0;">Practice Load</h2>
    <div id="plMeta" class="muted" style="margin-bottom:8px;"></div>
    <p id="plDesc" style="white-space:pre-wrap;"></p>
    <div id="plFacts" class="pl-facts"></div>

    <!-- 4 metrics only inside this grid -->
    <div class="grid" style="grid-template-columns: repeat(4, minmax(0, 1fr)); gap:12px; margin:12px 0;">
      <div class="card"><div class="muted">Session Load</div><div id="plM_load" class="mono" style="font-size:18px;">—</div></div>
      <div class="card"><div class="muted">ACWR</div><div id="plM_acwr" class="mono" style="font-size:18px;">—</div></div>
      <div class="card"><div class="muted">Monotony</div><div id="plM_mono" class="mono" style="font-size:18px;">—</div></div>
      <div class="card"><div class="muted">Strain</div><div id="plM_strain" class="mono" style="font-size:18px;">—</div></div>
    </div>

    <!-- Insights OUTSIDE the metrics grid -->
    <h4 class="mt-8">Insights</h4>
    <div id="plInsights" class="pl-insights"></div>

    <div class="card" style="margin-top:12px;">
      <div class="sectionTitle">14-Day Trend</div>
      <canvas id="plChart" height="160"></canvas>
      <div id="plChartNote" class="muted" style="margin-top:6px;"></div>
    </div>

    <div class="grid g2" style="margin-top:12px;">
      <div class="card">
        <div class="sectionTitle">Positives</div>
        <ul id="plPos"><li class="muted">—</li></ul>
      </div>
      <div class="card">
        <div class="sectionTitle">Suggestions</div>
        <ul id="plSug"><li class="muted">—</li></ul>
      </div>
    </div>
  </div>
</div>










<!-- note library -->
<div id="panel-notes" class="panel">
  <h1>Notes Library</h1>

<div class="notes-filters">
  <div class="filter-block">
    <label for="nPlayer">Player</label>
    <select id="nPlayer"></select>
  </div>

  <div class="filter-block">
    <label for="nCoach">Coach</label>
    <select id="nCoach"></select>
  </div>

  <div class="filter-block">
    <label for="nSession">Session</label>
    <select id="nSession"></select>
  </div>

  <div class="filter-block">
    <label for="nScore">Score</label>
    <select id="nScore">
      <option value="">All</option>
      <option value="bad">Bad (&lt;3.0)</option>
      <option value="ok">OK (3.0–3.99)</option>
      <option value="good">Good (≥4.0)</option>
    </select>
  </div>

  <div class="filter-block">
    <label for="nQ">Search</label>
    <input type="text" id="nQ" placeholder="Search notes…">
  </div>

  <div class="filter-buttons">
    <button id="nApply" class="apply">Apply</button>
    <button id="nClear" class="clear">Clear</button>
  </div>
</div>

  <!-- Message area -->
  <div id="nMsg" class="muted" style="margin:6px 0;"></div>

  <!-- Notes list -->
  <div class="card" style="padding:10px; border:1px solid var(--border); border-radius:12px;">
    <div class="sectionTitle" style="margin-top:0;">Notes</div>
    <div id="notesList"></div>
  </div>
</div>













<!-- Coach Notifications Popup -->
<div id="coachNotify"
     style="position:fixed; bottom:20px; right:20px; z-index:20010; display:none;
            background:#1e2530; color:#e9edf6; border:1px solid #2a3448; border-left:3px solid #4aa8ff;
            padding:8px 10px; border-radius:8px; box-shadow:0 8px 24px rgba(0,0,0,.35); max-width:220px; width:220px;
            transition:opacity 0.3s ease, transform 0.3s ease;">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:4px;">
    <div id="coachNotifyProgress" style="font-size:10px; color:#a0a8b8; font-weight:500;"></div>
    <div style="display:flex; gap:3px;">
      <button id="coachNotifyMute" class="presence-btn" style="padding:3px 6px; font-size:11px; min-width:24px; min-height:24px;" title="Mute notifications">🔇</button>
      <button id="coachNotifyRefresh" class="presence-btn" style="padding:3px 6px; font-size:11px; min-width:24px; min-height:24px;" title="Refresh notifications">↻</button>
    </div>
  </div>
  <div id="coachNotifyTitle" style="font-weight:700; margin-bottom:3px; font-size:12px; color:#e9edf6; line-height:1.3;"></div>
  <div id="coachNotifyText" style="font-size:11px; line-height:1.35; color:#c8d0e0; margin-bottom:6px;"></div>

  <div id="coachNotifyActions" style="display:flex; gap:4px; flex-wrap:wrap; margin-bottom:6px;"></div>

  <div style="display:flex; gap:4px; justify-content:flex-end; align-items:center; padding-top:5px; border-top:1px solid #2a3448;">
    <button id="coachNotifyPrev" class="presence-btn" style="padding:4px 8px; font-size:12px; min-width:28px; min-height:24px;" title="Previous (←)">◂</button>
    <button id="coachNotifyNext" class="presence-btn" style="padding:4px 8px; font-size:12px; min-width:28px; min-height:24px;" title="Next (→)">▸</button>
    <button id="coachNotifyClose" class="presence-btn" style="padding:4px 8px; font-size:12px; min-width:28px; min-height:24px;" title="Close (Esc)">✕</button>
  </div>
</div>


<!-- Ratings Modal -->
<div id="ratingsModal" class="modal" style="display:none;">
  <div class="modal-card">
    <header>
      <div>Coach Ratings</div>
      <button class="icon" onclick="closeRatingsModal()" title="Close">✕</button>
    </header>

    <div class="modal-body">
      <!-- Form line -->
      <div class="rate-form">
        <label>
          <span>Coach</span>
          <select id="rtCoach"></select>
        </label>
        <label>
          <span>Session</span>
          <select id="rtSession"></select>
        </label>
        <label>
          <span>Date</span>
          <input type="date" id="rtDate">
        </label>
        <div class="grow"></div>
        <button class="btn apply" id="rtSaveBtn" onclick="saveRatings()">Save</button>
      </div>

      <!-- Quick fill row -->
      <div class="rate-quickfill">
        <span>Set all to:</span>
        <select id="rtAllVal">
          <option value="">—</option>
          <option>5</option><option>4</option><option>3</option><option>2</option><option>1</option>
        </select>
        <button class="btn" onclick="applyAll()">Apply to all traits</button>
      </div>

      <!-- Players table -->
      <div class="rate-table">
        <div class="rate-table-hint">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm.75 15h-1.5v-6h1.5v6zm0-7.8h-1.5V7h1.5v2.2z"/>
          </svg>
          <span>Scroll to review each player. Headers and names stay pinned so you always know what you are editing.</span>
        </div>
        <div class="rate-table-scroll">
          <table id="rtTable">
            <thead>
              <tr>
                <th class="player-col">Player</th>
                <th data-trait="exec">Exec</th>
                <th data-trait="energy">Energy</th>
                <th data-trait="comm">Comm</th>
                <th data-trait="adapt">Adapt</th>
                <th data-trait="resilience">Resilience</th>
                <th data-trait="impact">Impact</th>
                <th style="min-width:300px;">Notes</th>
              </tr>
            </thead>
            <tbody><!-- rows injected --></tbody>
          </table>
        </div>
      </div>

      <div id="rtMsg" class="muted rate-message"></div>
    </div>
  </div>
</div>




    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
(function(){
  function decodeBase64Utf8(data) {
    if (!data) return '';
    const binary = atob(data);
    try {
      if (typeof TextDecoder === 'function') {
        const bytes = new Uint8Array(binary.length);
        for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
        return new TextDecoder('utf-8').decode(bytes);
      }
    } catch (err) {
      console.warn('TextDecoder failed; falling back to escape/decodeURIComponent.', err);
    }
    return decodeURIComponent(escape(binary));
  }

  try {
    const base64 = `<?!= include('tmp_script_base64'); ?>`;
    const raw = decodeBase64Utf8(base64);
    new Function(raw)();
  } catch (err) {
    console.error('Failed to bootstrap client bundle', err);
  }
})();
    </script>

    <script>
// Zone Leaders (client-side, uses server shots API)
(function(){
  var debounceTimer = null;
  function $(id){ return document.getElementById(id); }
  function rightHalfCoords(shot, SRC){
    var x = Number(shot.x||0), y = Number(shot.y||0);
    if (x < SRC.w/2) x = SRC.w - x;
    return [x,y];
  }
  function zoneOf(shot, SRC){
    var HOOP_X = SRC.w, HOOP_Y = Math.round(SRC.h/2);
    var PAINT_R = 140, CORNER_BAND = 180;
    var t = String(shot.type||'').toLowerCase();
    var xy = rightHalfCoords(shot, SRC);
    var rx = xy[0], ry = xy[1];
    if (t === '3pt'){
      if (ry < CORNER_BAND || ry > (SRC.h - CORNER_BAND)) return 'c3';
      return 'a3';
    }
    var dx = HOOP_X - rx, dy = HOOP_Y - ry;
    var dist = Math.sqrt(dx*dx + dy*dy);
    if (dist <= PAINT_R) return 'paint';
    return 'mid';
  }
  function applyFilters(shots){
    var g = $('shot-game'), p = $('shot-player'), o = $('shot-opponent'), q = $('shot-period'), ty = $('shot-type'), r = $('shot-result');
    var gv = g ? g.value : '', pv = p ? p.value : '', ov = o ? o.value : '', qv = q ? q.value : '', tv = ty ? ty.value : '', rv = r ? r.value : '';
    return shots.filter(function(s){
      if (gv && String(s.gameId) !== gv) return false;
      if (pv && String(s.player) !== pv) return false;
      if (ov && String(s.opponent) !== ov) return false;
      if (qv && String(s.period) !== String(qv)) return false;
      if (tv && String(s.type||'').toLowerCase() !== tv) return false;
      if (rv !== '' && String(s.made) !== rv) return false;
      return true;
    });
  }
  function renderZoneLeaders(container, leaders){
    if (!container) return;
    var labels = { paint:'Paint (2PT)', mid:'Midrange (2PT)', c3:'Corner 3', a3:'Above Break 3' };
    var order = ['paint','mid','c3','a3'];
    var html = order.map(function(z){
      var L = leaders[z];
      if (!L) return '<div class="muted">No data for '+labels[z]+'</div>';
      var fg = L.attempts ? ((L.makes*100/L.attempts).toFixed(1)+'%') : '0%';
      var ep = (L.ep).toFixed(2);
      return (
        '<div class="shot-dist-bar" style="grid-template-columns:140px 1fr 160px; gap:8px; align-items:center;">'
        + '<div style="font-weight:500; color:#cbd8f8;">'+labels[z]+'</div>'
        + '<div class="muted" style="font-size:12px;">'+L.player+' • '+L.attempts+' att</div>'
        + '<div style="text-align:right; font-size:12px; font-weight:600;">FG '+fg+' • EP '+ep+'</div>'
        + '</div>'
      );
    }).join('');
    container.innerHTML = html;
  }
  function computeLeaders(shots, SRC){
    var byPlayer = new Map();
    shots.forEach(function(s){
      var name = String(s.player||'');
      if (!name) return;
      var zone = zoneOf(s, SRC);
      var m = byPlayer.get(name);
      if (!m) { m = { paint:{a:0,m:0}, mid:{a:0,m:0}, c3:{a:0,m:0}, a3:{a:0,m:0} }; byPlayer.set(name, m); }
      m[zone].a++; if (s.made) m[zone].m++;
    });
    var zones = ['paint','mid','c3','a3'];
    var out = {};
    zones.forEach(function(z){
      var best = null;
      byPlayer.forEach(function(zmap, player){
        var a = zmap[z].a, m = zmap[z].m;
        if (a === 0) return;
        var fg = m / a;
        var pts = (z === 'paint' || z === 'mid') ? 2 : 3;
        var ep = fg * pts;
        var rec = { player: player, attempts: a, makes: m, fg: fg, ep: ep };
        var MIN_ATT = 5;
        if (!best) { best = rec; return; }
        var lhsScore = (best.attempts >= MIN_ATT ? best.ep : (best.ep * (best.attempts/Math.max(best.attempts, MIN_ATT))));
        var rhsScore = (rec.attempts  >= MIN_ATT ? rec.ep  : (rec.ep  * (rec.attempts /Math.max(rec.attempts , MIN_ATT))));
        if (rhsScore > lhsScore) best = rec;
      });
      if (best) out[z] = best;
    });
    return out;
  }
  function update(){
    var box = $('panel-shotmap');
    var target = $('shot-zoneLeaders');
    if (!box || !target) return;
    try {
      google.script.run
        .withSuccessHandler(function(res){
          if (!res || !res.shots) { target.innerHTML = '<div class="muted">No data</div>'; return; }
          var shots = applyFilters(res.shots);
          var leaders = computeLeaders(shots, res.srcSize || { w:1000, h:1000 });
          renderZoneLeaders(target, leaders);
        })
        .withFailureHandler(function(){ target.innerHTML = '<div class="muted">Failed to load data</div>'; })
        .shotMapGetShots();
    } catch (e) {
      // Likely not in Apps Script context yet
    }
  }
  function bind(){
    var controls = document.querySelectorAll('#panel-shotmap select, #panel-shotmap input');
    controls.forEach(function(el){
      var evt = (el.type === 'range' || el.type === 'checkbox') ? 'input' : 'change';
      el.addEventListener(evt, function(){
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(update, 150);
      });
    });
    var obsTarget = $('shot-filterSummary');
    if (obsTarget && window.MutationObserver){
      var mo = new MutationObserver(function(){
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(update, 150);
      });
      mo.observe(obsTarget, { childList:true, subtree:true, characterData:true });
    }
  }
  document.addEventListener('DOMContentLoaded', function(){
    bind();
    setTimeout(update, 400);
  });
})();
// Admin Portal Functions
function loadAdminStats() {
  console.log('loadAdminStats called');
  const summaryEl = document.getElementById('adminSummaryContent');
  const userStatsEl = document.getElementById('adminUserStats');
  const recentActivityEl = document.getElementById('adminRecentActivity');
  const sessionsEl = document.getElementById('adminSessions');
  
  console.log('Elements found:', {
    summary: !!summaryEl,
    userStats: !!userStatsEl,
    recentActivity: !!recentActivityEl,
    sessions: !!sessionsEl
  });
  
  const allEls = [summaryEl, document.getElementById('adminLeaderboard'), document.getElementById('adminFeatureUsage'), document.getElementById('adminPlayerCoverage'), recentActivityEl, sessionsEl];
  allEls.forEach(el => {
    if (el) {
      el.style.color = '#a0a8b8';
      el.textContent = 'Loading...';
    }
  });

  google.script.run
    .withSuccessHandler(function(res) {
      console.log('Admin stats response received:', res);
      
      // Handle case where res is null/undefined
      if (res === null || res === undefined) {
        console.error('Received null/undefined response');
        const allElements = [summaryEl, document.getElementById('adminLeaderboard'), document.getElementById('adminFeatureUsage'), document.getElementById('adminPlayerCoverage'), document.getElementById('adminRecentActivity'), document.getElementById('adminSessions')];
        allElements.forEach(el => {
          if (el) el.innerHTML = '<div class="muted" style="color:#ff5a5f;">Server returned no data. Please check console for errors.</div>';
        });
        return;
      }
      
      const allElements = [summaryEl, document.getElementById('adminLeaderboard'), document.getElementById('adminFeatureUsage'), document.getElementById('adminPlayerCoverage'), document.getElementById('adminRecentActivity'), document.getElementById('adminSessions')];
      
      if (!res) {
        const msg = 'No response from server. Please try refreshing.';
        allElements.forEach(el => {
          if (el) el.innerHTML = '<div class="muted" style="color:#ff5a5f;">' + msg + '</div>';
        });
        return;
      }
      
      if (!res.ok) {
        const msg = (res && res.error) || 'Failed to load admin stats.';
        allElements.forEach(el => {
          if (el) el.innerHTML = '<div class="muted" style="color:#ff5a5f;">' + escapeHtml(msg) + '</div>';
        });
        // Even on error, try to show what we have
        if (res.summary) {
          renderSummary(summaryEl, res.summary);
        }
        return;
      }

      // Helper function to render summary
      function renderSummary(el, s) {
        if (!el) return;
        if (!s) {
          el.innerHTML = '<div class="muted">No summary data available yet. Data will appear as users interact with the app.</div>';
          return;
        }
        el.innerHTML = `
          <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:16px;">
            <div>
              <div style="font-size:24px; font-weight:700;">${s.totalUsers || 0}</div>
              <div class="muted" style="font-size:12px;">Total Users</div>
            </div>
            <div>
              <div style="font-size:24px; font-weight:700;">${s.totalLogins || 0}</div>
              <div class="muted" style="font-size:12px;">Total Logins</div>
            </div>
            <div>
              <div style="font-size:24px; font-weight:700;">${s.totalRatings || 0}</div>
              <div class="muted" style="font-size:12px;">Total Ratings</div>
            </div>
            <div>
              <div style="font-size:24px; font-weight:700;">${s.totalNotes || 0}</div>
              <div class="muted" style="font-size:12px;">Total Notes</div>
            </div>
          </div>
        `;
      }
      
      // Summary - always render, even if empty
      renderSummary(summaryEl, res.summary);

      // Leaderboard (sorted by engagement score, Dimitris first)
      const leaderboardEl = document.getElementById('adminLeaderboard');
      console.log('User stats count:', res.userStats ? res.userStats.length : 0);
      console.log('Sessions count:', res.sessions ? res.sessions.length : 0);
      if (leaderboardEl && res.userStats && res.userStats.length > 0) {
        leaderboardEl.innerHTML = res.userStats.map((u, index) => {
          const hours = Math.floor((u.totalMinutes || 0) / 60);
          const mins = Math.round((u.totalMinutes || 0) % 60);
          // Display last login - ALWAYS use original date string from sheet to avoid timezone issues
          let lastLogin = 'Never';
          
          // First try to use lastLoginString from userStats (most direct - pre-calculated)
          if (u.lastLoginString && String(u.lastLoginString).trim()) {
            lastLogin = String(u.lastLoginString).trim();
          } 
          // Then try to get from sessions array
          else if (res && res.sessions && Array.isArray(res.sessions)) {
            const userLogins = res.sessions.filter(s => s.name === u.name && s.event === 'login');
            if (userLogins.length > 0) {
              // Sort by timestamp and get most recent
              const recentLogin = userLogins.sort((a, b) => {
                const tsA = typeof a.timestamp === 'number' ? a.timestamp : 0;
                const tsB = typeof b.timestamp === 'number' ? b.timestamp : 0;
                return tsB - tsA;
              })[0];
              
              if (recentLogin && recentLogin.timestampString && String(recentLogin.timestampString).trim()) {
                lastLogin = String(recentLogin.timestampString).trim();
              }
            }
          }
          const medal = index === 0 && u.name !== 'Dimitris' ? '🥇' : index === 1 && u.name !== 'Dimitris' ? '🥈' : index === 2 && u.name !== 'Dimitris' ? '🥉' : '';
          const streakEmoji = u.streak >= 7 ? '🔥' : u.streak >= 3 ? '⚡' : '';
          return `
            <div style="padding:12px; margin-bottom:8px; background:#0f131a; border-radius:8px; border:1px solid var(--border); cursor:pointer;" onclick="showUserDetail('${escapeHtml(u.name)}')">
              <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px;">
                <div style="font-weight:600;">${medal} ${escapeHtml(u.name)}</div>
                <div style="font-size:11px; color:#4CAF50; font-weight:600;">Score: ${u.engagementScore || 0}</div>
              </div>
              <div style="font-size:12px; color:#a0a8b8;">
                <div>📊 ${u.ratingsCount} ratings • 📝 ${u.notesCount} notes</div>
                <div>🔐 ${u.logins} logins • ⏱️ ${hours}h ${mins}m</div>
                <div>${streakEmoji} ${u.streak || 0}-day streak • 🕐 ${lastLogin}</div>
              </div>
            </div>
          `;
        }).join('');
      } else if (leaderboardEl) {
        leaderboardEl.innerHTML = '<div class="muted">No user statistics yet. Statistics will appear after users log in and use the app.</div>';
      }

      // Feature Usage
      const featureUsageEl = document.getElementById('adminFeatureUsage');
      if (featureUsageEl && res.featureUsage) {
        const features = Object.entries(res.featureUsage)
          .map(([name, count]) => ({ name, count }))
          .sort((a, b) => b.count - a.count)
          .slice(0, 15);
        
        if (features.length > 0) {
          featureUsageEl.innerHTML = features.map(f => `
            <div style="padding:8px; margin-bottom:4px; background:#0f131a; border-radius:6px; font-size:12px; display:flex; justify-content:space-between;">
              <span>${escapeHtml(f.name)}</span>
              <span style="font-weight:600; color:#4CAF50;">${f.count}</span>
            </div>
          `).join('');
        } else {
          featureUsageEl.innerHTML = '<div class="muted">No feature usage data yet. Feature tracking starts when users switch tabs.</div>';
        }
      }

      // Player Coverage
      const playerCoverageEl = document.getElementById('adminPlayerCoverage');
      if (playerCoverageEl && res.playerCoverage && res.playerCoverage.length > 0) {
        playerCoverageEl.innerHTML = res.playerCoverage.map((p, index) => {
          const medal = index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : '';
          return `
            <div style="padding:8px; margin-bottom:4px; background:#0f131a; border-radius:6px; font-size:12px;">
              <div style="display:flex; justify-content:space-between; margin-bottom:2px;">
                <span style="font-weight:600;">${medal} ${escapeHtml(p.player)}</span>
                <span style="color:#4CAF50;">${p.ratings} ratings</span>
              </div>
              ${p.notes > 0 ? `<div style="font-size:11px; color:#a0a8b8;">📝 ${p.notes} notes</div>` : ''}
            </div>
          `;
        }).join('');
      } else if (playerCoverageEl) {
        playerCoverageEl.innerHTML = '<div class="muted">No player coverage data yet. Data will appear as coaches rate players.</div>';
      }

      // Recent Activity
      if (recentActivityEl && res.recentActivities) {
        if (res.recentActivities.length === 0) {
          recentActivityEl.innerHTML = '<div class="muted">No recent activity</div>';
        } else {
          // Debug: log first activity to see what we're receiving
          if (res.recentActivities.length > 0) {
            console.log('First activity from server:', JSON.stringify(res.recentActivities[0]));
          }
          recentActivityEl.innerHTML = res.recentActivities.slice(0, 30).map(act => {
            // Use timestampString directly from sheet to avoid timezone conversion
            let time = 'Unknown';
            if (act.timestampString && String(act.timestampString).trim()) {
              time = String(act.timestampString).trim();
              console.log('Activity time from timestampString:', time);
            } else {
              console.log('Activity missing timestampString, act:', act);
            }
            const details = act.details || {};
            let detailText = '';
            if (act.action === 'rating') {
              detailText = `${details.rowsSaved || 0} ratings saved`;
            } else if (act.action === 'login') {
              detailText = 'Logged in';
            } else if (act.action === 'logout') {
              detailText = details.durationMinutes ? `Logged out (${details.durationMinutes} min session)` : 'Logged out';
            }
            return `
              <div style="padding:8px; margin-bottom:4px; background:#0f131a; border-radius:6px; font-size:12px; border-left:3px solid var(--border);">
                <div><strong>${escapeHtml(act.user)}</strong> • ${escapeHtml(act.action)} • ${escapeHtml(detailText)}</div>
                <div class="muted" style="font-size:11px; margin-top:2px;">${escapeHtml(time)}</div>
              </div>
            `;
          }).join('');
        }
      }

      // Sessions
      if (sessionsEl && res.sessions) {
        if (res.sessions.length === 0) {
          sessionsEl.innerHTML = '<div class="muted">No session history</div>';
        } else {
          sessionsEl.innerHTML = res.sessions.slice(-50).reverse().map(sess => {
            // Use timestampString directly from sheet to avoid timezone conversion
            let time = 'Unknown';
            if (sess.timestampString && String(sess.timestampString).trim()) {
              time = String(sess.timestampString).trim();
            }
            const eventType = sess.event === 'login' ? '🟢' : '🔴';
            return `
              <div style="padding:8px; margin-bottom:4px; background:#0f131a; border-radius:6px; font-size:12px; display:flex; justify-content:space-between; align-items:center; border-left:3px solid ${sess.event === 'login' ? '#4CAF50' : '#f44336'};">
                <div>
                  <strong>${escapeHtml(sess.name)}</strong> ${eventType} ${escapeHtml(sess.event)}
                </div>
                <div class="muted" style="font-size:11px;">${escapeHtml(time)}</div>
              </div>
            `;
          }).join('');
        }
      }
    })
    .withFailureHandler(function(err) {
      console.error('Admin stats failure handler called:', err);
      const errMsg = err && err.message ? err.message : String(err || 'Unknown error');
      const msg = 'Failed to load admin stats: ' + errMsg;
      console.error('Full error:', err);
      const allElements = [summaryEl, document.getElementById('adminLeaderboard'), document.getElementById('adminFeatureUsage'), document.getElementById('adminPlayerCoverage'), document.getElementById('adminRecentActivity'), document.getElementById('adminSessions')];
      allElements.forEach(el => {
        if (el) el.innerHTML = '<div class="muted" style="color:#ff5a5f;">' + escapeHtml(msg) + '<br><small>Check browser console (F12) for details.</small></div>';
      });
    })
    .getAdminStats();
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// Track tab/feature usage for admin analytics
function trackTabView(tabName) {
  if (!window.CURRENT_USER_NAME || window.CURRENT_USER_NAME === 'Visitor') return;
  
  try {
    google.script.run
      .withSuccessHandler(function() {})
      .withFailureHandler(function(err) { console.error('Tab tracking failed:', err); })
      ._logUserActivity(window.CURRENT_USER_NAME, 'tab_view', { feature: tabName });
  } catch (e) {
    console.error('Tab tracking error:', e);
  }
}

// Show/hide admin tab based on user
function updateAdminTabVisibility() {
  const adminTabItem = document.getElementById('adminTabItem');
  const adminPanel = document.getElementById('panel-admin');
  
  // Only show admin tab for Dimitris
  const isAdmin = window.CURRENT_USER_NAME === 'Dimitris';
  
  if (adminTabItem) {
    adminTabItem.style.display = isAdmin ? '' : 'none';
  }
  
  // If admin panel is active but user is not admin, hide it and show home instead
  if (adminPanel && adminPanel.classList.contains('active') && !isAdmin) {
    adminPanel.classList.remove('active');
    const homePanel = document.getElementById('panel-home');
    if (homePanel) {
      homePanel.classList.add('active');
      // Also update the active tab in sidebar
      document.querySelectorAll('.sideItem').forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('data-tab') === 'home') {
          item.classList.add('active');
        }
      });
      // Trigger the showPanel function if it exists
      if (typeof showPanel === 'function') {
        showPanel('home');
      }
    }
  }
}

// Auto-load admin stats when admin panel is opened
document.addEventListener('DOMContentLoaded', function() {
  // Check admin visibility on load
  updateAdminTabVisibility();
  
  // Listen for admin tab clicks - use event delegation since tab switching might be handled elsewhere
  document.addEventListener('click', function(e) {
    const adminTab = e.target.closest('[data-tab="admin"]');
    if (adminTab) {
      console.log('Admin tab clicked');
      setTimeout(function() {
        const adminPanel = document.getElementById('panel-admin');
        const isActive = adminPanel && adminPanel.classList.contains('active');
        console.log('Admin panel:', adminPanel, 'Active:', isActive);
        if (adminPanel && isActive) {
          console.log('Panel is active, loading admin stats...');
          if (typeof loadAdminStats === 'function') {
            loadAdminStats();
          } else {
            console.error('loadAdminStats function not found!');
          }
        }
      }, 200);
    }
  });

  // Also watch for panel visibility changes using the 'active' class (how panels are shown/hidden)
  const adminPanel = document.getElementById('panel-admin');
  if (adminPanel) {
    let wasVisible = adminPanel.classList.contains('active');
    
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
          const isVisible = adminPanel.classList.contains('active');
          console.log('Panel visibility changed (active class):', isVisible, 'was:', wasVisible);
          if (isVisible && !wasVisible && typeof loadAdminStats === 'function') {
            console.log('Panel just became active, loading stats...');
            setTimeout(loadAdminStats, 100);
          }
          wasVisible = isVisible;
        }
      });
    });
    observer.observe(adminPanel, { attributes: true, attributeFilter: ['class'] });
    
    // Also check on interval in case MutationObserver misses something
    setInterval(function() {
      const isVisible = adminPanel.classList.contains('active');
      if (isVisible && !wasVisible && typeof loadAdminStats === 'function') {
        console.log('Panel detected as active via interval, loading stats...');
        loadAdminStats();
      }
      wasVisible = isVisible;
    }, 500);
  }
  
  // Watch for CURRENT_USER_NAME changes (after login)
  let lastUserName = window.CURRENT_USER_NAME || '';
  setInterval(function() {
    const currentUserName = window.CURRENT_USER_NAME || '';
    if (currentUserName !== lastUserName) {
      lastUserName = currentUserName;
      updateAdminTabVisibility();
    }
  }, 500);
  
  // Track tab views by intercepting showPanel if it exists
  if (typeof showPanel !== 'undefined') {
    const originalShowPanel = window.showPanel;
    window.showPanel = function(tabName) {
      if (originalShowPanel) originalShowPanel(tabName);
      if (typeof trackTabView === 'function') {
        trackTabView(tabName);
      }
    };
  }
  
  // Also track via sidebar clicks
  document.addEventListener('click', function(e) {
    const sideItem = e.target.closest('#sideNav .sideItem[data-tab]');
    if (sideItem) {
      const tabName = sideItem.getAttribute('data-tab');
      if (tabName && typeof trackTabView === 'function') {
        setTimeout(function() { trackTabView(tabName); }, 100);
      }
    }
  });
});

// User Detail Functions
function showUserDetail(userName) {
  const modal = document.getElementById('userDetailModal');
  const nameEl = document.getElementById('userDetailName');
  const contentEl = document.getElementById('userDetailContent');
  
  if (!modal || !nameEl || !contentEl) return;
  
  nameEl.textContent = userName + ' - Detailed Stats';
  contentEl.textContent = 'Loading...';
  modal.style.display = 'flex';
  
  google.script.run
    .withSuccessHandler(function(res) {
      console.log('getUserDetailStats response:', res);
      if (!res || !res.ok) {
        const errorMsg = res && res.error ? res.error : 'Unknown error';
        console.error('getUserDetailStats failed:', errorMsg);
        contentEl.innerHTML = '<div style="color:#ff5a5f;">Failed to load user details: ' + escapeHtml(errorMsg) + '</div>';
        return;
      }
      
      const stats = res.stats || {};
      const hours = Math.floor((stats.totalTimeMinutes || 0) / 60);
      const mins = Math.round((stats.totalTimeMinutes || 0) % 60);
      
      let html = `
        <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:16px; margin-bottom:20px;">
          <div style="padding:12px; background:#0f131a; border-radius:8px;">
            <div style="font-size:24px; font-weight:700; color:#e9edf6;">${stats.logins || 0}</div>
            <div class="muted" style="font-size:12px;">Total Logins</div>
          </div>
          <div style="padding:12px; background:#0f131a; border-radius:8px;">
            <div style="font-size:24px; font-weight:700; color:#e9edf6;">${stats.ratings || 0}</div>
            <div class="muted" style="font-size:12px;">Ratings</div>
          </div>
          <div style="padding:12px; background:#0f131a; border-radius:8px;">
            <div style="font-size:24px; font-weight:700; color:#e9edf6;">${stats.notes || 0}</div>
            <div class="muted" style="font-size:12px;">Notes</div>
          </div>
          <div style="padding:12px; background:#0f131a; border-radius:8px;">
            <div style="font-size:24px; font-weight:700; color:#e9edf6;">${hours}h ${mins}m</div>
            <div class="muted" style="font-size:12px;">Total Time</div>
          </div>
        </div>
      `;
      
      // Top Players
      if (res.stats && res.stats.topPlayers && res.stats.topPlayers.length > 0) {
        html += `
          <div style="margin-bottom:20px;">
            <div class="sectionTitle" style="color:#e9edf6; margin-bottom:8px;">Most Rated Players</div>
            ${res.stats.topPlayers.map(p => `
              <div style="padding:8px; margin-bottom:4px; background:#0f131a; border-radius:6px; font-size:12px; display:flex; justify-content:space-between;">
                <span>${escapeHtml(p.player)}</span>
                <span style="font-weight:600; color:#4CAF50;">${p.count} ratings</span>
              </div>
            `).join('')}
          </div>
        `;
      }
      
      // Feature/Tab Usage
      if (res.tabUsage && Object.keys(res.tabUsage).length > 0) {
        const tabs = Object.entries(res.tabUsage)
          .map(([name, count]) => ({ name, count }))
          .sort((a, b) => b.count - a.count);
        html += `
          <div style="margin-bottom:20px;">
            <div class="sectionTitle" style="color:#e9edf6; margin-bottom:8px;">Feature Usage</div>
            ${tabs.map(t => `
              <div style="padding:8px; margin-bottom:4px; background:#0f131a; border-radius:6px; font-size:12px; display:flex; justify-content:space-between;">
                <span>${escapeHtml(t.name)}</span>
                <span style="font-weight:600; color:#4CAF50;">${t.count}</span>
              </div>
            `).join('')}
          </div>
        `;
      }
      
      // Recent Activity Timeline
      if (res.activities && res.activities.length > 0) {
        html += `
          <div style="margin-bottom:20px;">
            <div class="sectionTitle" style="color:#e9edf6; margin-bottom:8px;">Recent Activity Timeline</div>
            <div style="max-height:300px; overflow:auto;">
              ${res.activities.slice(0, 30).map(act => {
                // Use original date string from sheet - no timezone conversion
                let time = 'Unknown';
                if (act.timestampString && act.timestampString.trim()) {
                  time = String(act.timestampString).trim();
                }
                const details = act.details || {};
                let detailText = '';
                if (act.action === 'rating') {
                  detailText = `${details.rowsSaved || 0} ratings saved`;
                } else if (act.action === 'tab_view') {
                  detailText = `Viewed: ${details.feature || act.action}`;
                } else if (act.action === 'login') {
                  detailText = 'Logged in';
                } else if (act.action === 'logout') {
                  detailText = `Logged out (${details.durationMinutes || 0} min)`;
                } else {
                  detailText = JSON.stringify(details);
                }
                return `
                  <div style="padding:8px; margin-bottom:4px; background:#0f131a; border-radius:6px; font-size:12px; border-left:3px solid var(--border);">
                    <div><strong>${escapeHtml(act.action)}</strong> • ${escapeHtml(detailText)}</div>
                    <div class="muted" style="font-size:11px; margin-top:2px;">${time}</div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `;
      }
      
      // Recent Sessions
      if (res.sessions && res.sessions.length > 0) {
        html += `
          <div>
            <div class="sectionTitle" style="color:#e9edf6; margin-bottom:8px;">Recent Sessions</div>
            <div style="max-height:300px; overflow:auto;">
              ${res.sessions.slice(0, 20).map(sess => {
                // ALWAYS use original date string from sheet - no timezone conversion
                let time = 'Unknown';
                if (sess.timestampString && sess.timestampString.trim()) {
                  time = String(sess.timestampString).trim();
                }
                const eventColor = sess.event === 'login' ? '#4CAF50' : '#f44336';
                return `
                  <div style="padding:8px; margin-bottom:4px; background:#0f131a; border-radius:6px; font-size:12px; display:flex; justify-content:space-between; border-left:3px solid ${eventColor};">
                    <span><strong>${escapeHtml(sess.event)}</strong></span>
                    <span class="muted" style="font-size:11px;">${escapeHtml(time)}</span>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `;
      }
      
      if (html === '') {
        html = '<div class="muted">No detailed data available yet.</div>';
      }
      
      contentEl.innerHTML = html;
    })
    .withFailureHandler(function(err) {
      console.error('getUserDetailStats failure:', err);
      const errorMsg = err && err.message ? err.message : String(err || 'Unknown error');
      contentEl.innerHTML = '<div style="color:#ff5a5f;">Error loading user details: ' + escapeHtml(errorMsg) + '<br><small>Check browser console (F12) for details.</small></div>';
    })
    .getUserDetailStats(userName);
}

function closeUserDetail() {
  const modal = document.getElementById('userDetailModal');
  if (modal) modal.style.display = 'none';
}
    </script>





 
   











  </body>
</html>
